C51 COMPILER V9.60.7.0   MILEAGE                                                           11/25/2024 17:48:04 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MILEAGE
OBJECT MODULE PLACED IN .\Release\Objects\mileage.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\mileage.c LARGE OPTIMIZE(8,SIZE) BROWSE INTVECTOR(0X000C) INC
                    -DIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Lis
                    -tings\mileage.lst) OBJECT(.\Release\Objects\mileage.obj)

line level    source

   1          // é‡Œç¨‹è¡¨çš„æºç¨‹åº
   2          #include "mileage.h"
   3          
   4          volatile u32 mileage_scan_time_cnt = 0; // é‡Œç¨‹æ‰«ææ‰€éœ€çš„è®¡æ•°å€¼,æ¯éš”ä¸€å®šæ—¶é—´å°†é‡Œç¨‹å†™å…
             -¥flash
   5          volatile u32 distance = 0;               // å­˜æ”¾æ¯æ¬¡æ‰«ææ—¶èµ°è¿‡çš„è·¯ç¨‹ï¼ˆå•ä½ï¼šæ¯«ç±³ï¼‰-->ç”
             -¨äºé‡Œç¨‹è¡¨çš„è®¡æ•°
   6          
   7          // æ€»é‡Œç¨‹æ‰«æ
   8          void mileage_scan(void)
   9          {
  10   1          static u32 old_total_mileage = 0;    // ç”¨æ¥è®°å½•æ—§çš„å¤§è®¡é‡Œç¨‹çš„å˜é‡
  11   1          static u32 old_subtotal_mileage = 0; // ç”¨æ¥è®°å½•æ—§çš„å°è®¡é‡Œç¨‹çš„å˜é‡
  12   1      
  13   1          if (mileage_scan_time_cnt >= 30000) // 30000 ms -- 30s
  14   1          {
  15   2              mileage_scan_time_cnt = 0;
  16   2              fun_info_save(); // å°† fun_info å†™å›flash
  17   2      
  18   2              printf("fun_info_save()");
  19   2          }
  20   1      
  21   1          if (distance >= 1000) // 1000mm -- 1m
  22   1          {
  23   2              // å¦‚æœèµ°è¿‡çš„è·ç¦»è¶…è¿‡äº†1mï¼Œå†è¿›è¡Œä¿å­˜
  24   2      
  25   2              // // é™åˆ¶å¤§è®¡é‡Œç¨‹åœ¨ 1000000000000 mm(1000,000km)ä»¥å†…
  26   2              // if (fun_info.save_info.total_mileage < (u32)1000000000000 - 1001)
  27   2              // {
  28   2              //     fun_info.save_info.total_mileage += distance / 1000; // å°†æ¯«ç±³è½¬æ¢æˆç±³ï¼Œå†ä¿å­˜
  29   2              // }
  30   2      
  31   2              // é™åˆ¶å¤§è®¡é‡Œç¨‹åœ¨ 1000,000km(1,000,000,000m)ä»¥å†…
  32   2              if (fun_info.save_info.total_mileage < (u32)1000000000)
  33   2              {
  34   3                  fun_info.save_info.total_mileage++; // +1m
  35   3              }
  36   2      
  37   2              // // é™åˆ¶å°è®¡é‡Œç¨‹åœ¨ 1,000,000,000 mm(1000km)ä»¥å†…
  38   2              // if (fun_info.save_info.subtotal_mileage < (u32)1000000000 - 1001)
  39   2              // {
  40   2              //     fun_info.save_info.subtotal_mileage += distance / 1000; // å°†æ¯«ç±³è½¬æ¢æˆç±³ï¼Œå†ä¿å­
             -˜
  41   2              // }
  42   2      
  43   2              // é™åˆ¶å°è®¡é‡Œç¨‹åœ¨ 1000km(1,000,000m)ä»¥å†…
  44   2              if (fun_info.save_info.subtotal_mileage < (u32)1000000)
  45   2              {
  46   3                  fun_info.save_info.subtotal_mileage++; // +1m
  47   3              }
  48   2      
  49   2              distance -= 1000; // å‰©ä¸‹çš„ã€æœªä¿å­˜çš„ã€ä¸æ»¡1mçš„æ•°æ®ç•™åˆ°ä¸‹ä¸€æ¬¡å†ä¿å­˜
  50   2          }
C51 COMPILER V9.60.7.0   MILEAGE                                                           11/25/2024 17:48:04 PAGE 2   

  51   1      
  52   1      #ifdef USE_INTERNATIONAL /* å…¬åˆ¶å•ä½ */
  53   1                               // å¦‚æœå¤§è®¡é‡Œç¨‹æœ‰å˜åŒ–ä¸”è¶…è¿‡äº†100m
  54   1          if ((fun_info.save_info.total_mileage - old_total_mileage) > 100)
  55   1      #else /* USE_IMPERIAL // è‹±åˆ¶å•ä½ */
                  // å¦‚æœå¤§è®¡é‡Œç¨‹æœ‰å˜åŒ–ä¸”è¶…è¿‡äº†161m(0.1è‹±é‡Œ)
                  if ((fun_info.save_info.total_mileage - old_total_mileage) > 161)
              #endif
  59   1          {
  60   2              old_total_mileage = fun_info.save_info.total_mileage; // è®°å½•æ—§çš„é‡Œç¨‹
  61   2      
  62   2              // printf("total mileage: %lum\n", fun_info.save_info.total_mileage);
  63   2      
  64   2              {
  65   3                  // å‘é€æ•°æ®çš„æ“ä½œï¼Œå¯ä»¥å…ˆç½®æ ‡å¿—ä½
  66   3                  flag_get_total_mileage = 1;
  67   3              }
  68   2          }
  69   1      
  70   1      #ifdef USE_INTERNATIONAL /* å…¬åˆ¶å•ä½ */
  71   1                               // å¦‚æœå°è®¡é‡Œç¨‹æœ‰å˜åŒ–ä¸”è¶…è¿‡äº†100m
  72   1          if ((fun_info.save_info.subtotal_mileage - old_subtotal_mileage) > 100)
  73   1      #else /* USE_IMPERIAL // è‹±åˆ¶å•ä½ */
                  // å¦‚æœå°è®¡é‡Œç¨‹æœ‰å˜åŒ–ä¸”è¶…è¿‡äº†161m(0.1è‹±é‡Œ)
                  if ((fun_info.save_info.subtotal_mileage - old_subtotal_mileage) > 161)
              #endif
  77   1          {
  78   2              old_subtotal_mileage = fun_info.save_info.subtotal_mileage; // è®°å½•æ—§çš„é‡Œç¨‹
  79   2      
  80   2              // printf("subtotal mileage: %lum\n", fun_info.save_info.subtotal_mileage);
  81   2      
  82   2              {
  83   3                  // å‘é€æ•°æ®çš„æ“ä½œï¼Œå¯ä»¥å…ˆç½®æ ‡å¿—ä½
  84   3                  flag_get_sub_total_mileage = 1;
  85   3              }
  86   2          }
  87   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    262    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =     16    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
