C51 COMPILER V9.60.7.0   MILEAGE                                                           11/23/2024 16:37:01 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MILEAGE
OBJECT MODULE PLACED IN .\Release\Objects\mileage.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\mileage.c LARGE OPTIMIZE(8,SIZE) BROWSE INTVECTOR(0X000C) INC
                    -DIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Lis
                    -tings\mileage.lst) OBJECT(.\Release\Objects\mileage.obj)

line level    source

   1          // é‡Œç¨‹è¡¨çš„æºç¨‹åº
   2          #include "mileage.h"
   3          
   4          volatile u32 mileage_scan_time_cnt = 0; // é‡Œç¨‹æ‰«ææ‰€éœ€çš„è®¡æ•°å€¼,æ¯éš”ä¸€å®šæ—¶é—´å°†é‡Œç¨‹å†™å…
             -¥flash
   5          
   6          // æ€»é‡Œç¨‹æ‰«æ
   7          void mileage_scan(void)
   8          {
   9   1          static u32 old_total_mileage = 0;    // ç”¨æ¥è®°å½•æ—§çš„å¤§è®¡é‡Œç¨‹çš„å˜é‡
  10   1          static u32 old_subtotal_mileage = 0; // ç”¨æ¥è®°å½•æ—§çš„å°è®¡é‡Œç¨‹çš„å˜é‡
  11   1      
  12   1          if (mileage_scan_time_cnt >= 30000) // 30000 ms -- 30s
  13   1          {
  14   2              mileage_scan_time_cnt = 0;
  15   2              fun_info_save(); // å°† fun_info å†™å›flash
  16   2      
  17   2              printf("fun_info_save()");
  18   2          }
  19   1      
  20   1          if (distance >= 1000) // 1000mm -- 1m
  21   1          {
  22   2              // å¦‚æœèµ°è¿‡çš„è·ç¦»è¶…è¿‡äº†1mï¼Œå†è¿›è¡Œä¿å­˜
  23   2      
  24   2              // // é™åˆ¶å¤§è®¡é‡Œç¨‹åœ¨ 1000000000000 mm(1000,000km)ä»¥å†…
  25   2              // if (fun_info.save_info.total_mileage < (u32)1000000000000 - 1001)
  26   2              // {
  27   2              //     fun_info.save_info.total_mileage += distance / 1000; // å°†æ¯«ç±³è½¬æ¢æˆç±³ï¼Œå†ä¿å­˜
  28   2              // }
  29   2      
  30   2              // é™åˆ¶å¤§è®¡é‡Œç¨‹åœ¨ 1000,000km(1,000,000,000m)ä»¥å†…
  31   2              if (fun_info.save_info.total_mileage < (u32)1000000000)
  32   2              {
  33   3                  fun_info.save_info.total_mileage++; // +1m
  34   3              }
  35   2      
  36   2              // // é™åˆ¶å°è®¡é‡Œç¨‹åœ¨ 1,000,000,000 mm(1000km)ä»¥å†…
  37   2              // if (fun_info.save_info.subtotal_mileage < (u32)1000000000 - 1001)
  38   2              // {
  39   2              //     fun_info.save_info.subtotal_mileage += distance / 1000; // å°†æ¯«ç±³è½¬æ¢æˆç±³ï¼Œå†ä¿å­
             -˜
  40   2              // }
  41   2      
  42   2              // é™åˆ¶å°è®¡é‡Œç¨‹åœ¨ 1000km(1,000,000m)ä»¥å†…
  43   2              if (fun_info.save_info.subtotal_mileage < (u32)1000000)
  44   2              {
  45   3                  fun_info.save_info.subtotal_mileage++; // +1m
  46   3              }
  47   2      
  48   2              distance -= 1000; // å‰©ä¸‹çš„ã€æœªä¿å­˜çš„ã€ä¸æ»¡1mçš„æ•°æ®ç•™åˆ°ä¸‹ä¸€æ¬¡å†ä¿å­˜
  49   2          }
  50   1      
  51   1      #ifdef USE_INTERNATIONAL /* å…¬åˆ¶å•ä½ */
C51 COMPILER V9.60.7.0   MILEAGE                                                           11/23/2024 16:37:01 PAGE 2   

  52   1                               // å¦‚æœå¤§è®¡é‡Œç¨‹æœ‰å˜åŒ–ä¸”è¶…è¿‡äº†100m
  53   1          if ((fun_info.save_info.total_mileage - old_total_mileage) > 100)
  54   1      #else /* USE_IMPERIAL // è‹±åˆ¶å•ä½ */
                  // å¦‚æœå¤§è®¡é‡Œç¨‹æœ‰å˜åŒ–ä¸”è¶…è¿‡äº†161m(0.1è‹±é‡Œ)
                  if ((fun_info.save_info.total_mileage - old_total_mileage) > 161)
              #endif
  58   1          {
  59   2              old_total_mileage = fun_info.save_info.total_mileage; // è®°å½•æ—§çš„é‡Œç¨‹
  60   2      
  61   2              // printf("total mileage: %lum\n", fun_info.save_info.total_mileage);
  62   2      
  63   2              {
  64   3                  // å‘é€æ•°æ®çš„æ“ä½œï¼Œå¯ä»¥å…ˆç½®æ ‡å¿—ä½
  65   3                  flag_get_total_mileage = 1;
  66   3              }
  67   2          }
  68   1      
  69   1      #ifdef USE_INTERNATIONAL /* å…¬åˆ¶å•ä½ */
  70   1                               // å¦‚æœå°è®¡é‡Œç¨‹æœ‰å˜åŒ–ä¸”è¶…è¿‡äº†100m
  71   1          if ((fun_info.save_info.subtotal_mileage - old_subtotal_mileage) > 100)
  72   1      #else /* USE_IMPERIAL // è‹±åˆ¶å•ä½ */
                  // å¦‚æœå°è®¡é‡Œç¨‹æœ‰å˜åŒ–ä¸”è¶…è¿‡äº†161m(0.1è‹±é‡Œ)
                  if ((fun_info.save_info.subtotal_mileage - old_subtotal_mileage) > 161)
              #endif
  76   1          {
  77   2              old_subtotal_mileage = fun_info.save_info.subtotal_mileage; // è®°å½•æ—§çš„é‡Œç¨‹
  78   2      
  79   2              // printf("subtotal mileage: %lum\n", fun_info.save_info.subtotal_mileage);
  80   2      
  81   2              {
  82   3                  // å‘é€æ•°æ®çš„æ“ä½œï¼Œå¯ä»¥å…ˆç½®æ ‡å¿—ä½
  83   3                  flag_get_sub_total_mileage = 1;
  84   3              }
  85   2          }
  86   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    262    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =     12    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
