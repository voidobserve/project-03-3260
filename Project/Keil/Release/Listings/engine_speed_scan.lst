C51 COMPILER V9.60.7.0   ENGINE_SPEED_SCAN                                                 11/23/2024 16:08:29 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE ENGINE_SPEED_SCAN
OBJECT MODULE PLACED IN .\Release\Objects\engine_speed_scan.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\engine_speed_scan.c LARGE OPTIMIZE(8,SIZE) BROWSE INTVECTOR(0
                    -X000C) INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\R
                    -elease\Listings\engine_speed_scan.lst) OBJECT(.\Release\Objects\engine_speed_scan.obj)

line level    source

   1          #include "engine_speed_scan.h"
   2          
   3          // ÂèëÂä®Êú∫ÊØèËΩ¨‰∏ÄÂúàÔºåËÉΩÊ£ÄÊµãÂà∞ÁöÑËÑâÂÜ≤‰∏™Êï∞
   4          #ifndef ENGINE_SPEED_SCAN_PULSE_PER_TURN
              #define ENGINE_SPEED_SCAN_PULSE_PER_TURN (16)
              #endif
   7          
   8          volatile u32 engine_speed_scan_time_cnt = 0; // ÂèëÂä®Êú∫ËΩ¨ÈÄüÊâ´ÊèèÊó∂ÔºåÁî®Âà∞ÁöÑÊó∂Èó¥ËÆ°Êï∞ÂÄºÔºå‰ºöÂ
             -ú®ÂÆöÊó∂Âô®‰∏≠Êñ≠‰∏≠Á¥ØÂä†
   9          
  10          volatile u32 detect_engine_pulse_cnt = 0; // Ê£ÄÊµãÂèëÈÄÅÊú∫ËΩ¨ÈÄüÁöÑËÑâÂÜ≤ËÆ°Êï∞ÂÄº
  11          
  12          // ÂèëÂä®Êú∫ËΩ¨ÈÄüÁöÑÁõ∏ÂÖ≥ÈÖçÁΩÆ
  13          void engine_speed_scan_config(void)
  14          {
  15   1          // ‰ΩøÁî®IO‰∏≠Êñ≠Êù•ÂØπËÑâÂÜ≤ËÆ°Êï∞
  16   1          __SetIRQnIP(P1_IRQn, P1_IQn_CFG); // ËÆæÁΩÆ‰∏≠Êñ≠‰ºòÂÖàÁ∫ß
  17   1          __EnableIRQ(P1_IRQn);             // ‰ΩøËÉΩP1‰∏≠Êñ≠
  18   1          IE_EA = 1;                        // ‰ΩøËÉΩÊÄªÂºÄÂÖ≥
  19   1      
  20   1          P1_MD0 &= ~GPIO_P12_MODE_SEL(0x3); // ËæìÂÖ•Ê®°Âºè
  21   1          P1_PU |= GPIO_P12_PULL_UP(0x1);    // ÈÖçÁΩÆ‰∏∫‰∏äÊãâ
  22   1          P1_IMK |= GPIO_P12_IRQ_MASK(0x1);  // ‰ΩøËÉΩIO‰∏≠Êñ≠
  23   1          P1_TRG0 &= ~GPIO_P12_TRG_SEL(0x3);
  24   1          P1_TRG0 |= GPIO_P12_TRG_SEL(0x2); // ÈÖçÁΩÆ‰∏äÂçáÊ≤øËß¶Âèë
  25   1      }
  26          
  27          // ÂèëÂä®Êú∫ËΩ¨ÈÄüÊâ´Êèè
  28          void engine_speed_scan(void)
  29          {
  30   1      #define CONVER_ONE_MINUTE_TO_MS (60000)
  31   1          u32 rpm = 0;
  32   1      
  33   1          if (engine_speed_scan_time_cnt >= ENGINE_SPEED_SCAN_TIME_MS) // Â¶ÇÊûúÂ∑≤ÁªèÂà∞‰∫ÜÁ¥ØËÆ°ÁöÑÊó∂Èó¥
  34   1          {
  35   2              engine_speed_scan_time_cnt -= ENGINE_SPEED_SCAN_TIME_MS; // ‰∏∫‰∫ÜÂáÜÁ°ÆÔºåÂáèÂéªËøôÈÉ®ÂàÜÊó∂Èó¥ÂØ
             -πÂ∫îÁöÑËÆ°Êï∞ÂÄºÔºåËÄå‰∏çÊòØÁõ¥Êé•Ê∏ÖÈõ∂
  36   2              // ‰∏ãÈù¢ÊòØÊ†πÊçÆ250msÊ£ÄÊµãÂà∞ÁöÑËÑâÂÜ≤‰∏™Êï∞Êù•ËÆ°ÁÆóÂá∫ÊØèÂàÜÈíüÁöÑËΩ¨ÈÄü
  37   2              // 250ms * 4 * 60 == 1min
  38   2              // rpm = detect_engine_pulse_cnt * 240 / ENGINE_SPEED_SCAN_PULSE_PER_TURN; // ËÆ°ÁÆóÂæóÂá∫1minÁöÑË
             -Ω¨ÈÄü
  39   2              
  40   2              // ËÆ°ÁÆóÂæóÂá∫1minÁöÑËΩ¨ÈÄü
  41   2              // Êâ´ÊèèÊó∂Èó¥ÂÜÖÂèëÂä®Êú∫ËΩ¨ËøáÁöÑÂúàÊï∞ == Êâ´ÊèèÊó∂Èó¥ÂÜÖÈááÈõÜÂà∞ÁöÑËÑâÂÜ≤‰∏™Êï∞ / ÂèëÂä®Êú∫‰
             -∏ÄÂúàÂØπÂ∫îÁöÑËÑâÂÜ≤‰∏™Êï∞
  42   2              // 1minÂÜÖÂèëÂä®Êú∫ÁöÑËΩ¨ÈÄü == 1min / Êâ´ÊèèÊó∂Èó¥ * Êâ´ÊèèÊó∂Èó¥ÂÜÖÂèëÂä®Êú∫ËΩ¨ËøáÁöÑÂúàÊï∞
  43   2              // Êç¢ÁÆóÊàêÂçïÁâáÊú∫ËÉΩÂ§üËÆ°ÁÆóÁöÑÂΩ¢ÂºèÔºö
  44   2              // 1minÂÜÖÂèëÂä®Êú∫ÁöÑËΩ¨ÈÄü == Êâ´ÊèèÊó∂Èó¥ÂÜÖÂèëÂä®Êú∫ËΩ¨ËøáÁöÑÂúàÊï∞ * 1min / Êâ´ÊèèÊó∂Èó¥
  45   2              // 1minÂÜÖÂèëÂä®Êú∫ÁöÑËΩ¨ÈÄü == Êâ´ÊèèÊó∂Èó¥ÂÜÖÈááÈõÜÂà∞ÁöÑËÑâÂÜ≤‰∏™Êï∞* 1min / ÂèëÂä®Êú∫‰∏ÄÂúàÂØπ
             -Â∫îÁöÑËÑâÂÜ≤‰∏™Êï∞ / Êâ´ÊèèÊó∂Èó¥
  46   2              rpm = detect_engine_pulse_cnt * (CONVER_ONE_MINUTE_TO_MS / ENGINE_SPEED_SCAN_TIME_MS) / ENGINE_SPE
             -ED_SCAN_PULSE_PER_TURN; 
  47   2              detect_engine_pulse_cnt = 0; // ËÆ°ÁÆóÂÆåÊàêÂêéÔºåÊ∏ÖÁ©∫ËÆ°Êï∞ÂÄº
C51 COMPILER V9.60.7.0   ENGINE_SPEED_SCAN                                                 11/23/2024 16:08:29 PAGE 2   

  48   2      
  49   2              // ÈôêÂà∂ÂæÖÂèëÈÄÅÁöÑÂèëÂä®Êú∫ËΩ¨ÈÄü
  50   2              if (rpm >= 65535)
  51   2              {
  52   3                  rpm = 65535;
  53   3              }
  54   2      
  55   2              fun_info.engine_speeed = rpm; //
  56   2      #if USE_MY_DEBUG
  57   2              // printf("engine speed %lu rpm\n", rpm);
  58   2      #endif
  59   2              flag_get_engine_speed = 1; // Â§ö‰πÖÊõ¥Êñ∞‰∏ÄÊ¨°Áä∂ÊÄÅËøòÊú™Á°ÆÂÆö
  60   2          }
  61   1      }
  62          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    182    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      8       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
