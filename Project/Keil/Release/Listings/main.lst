C51 COMPILER V9.60.7.0   MAIN                                                              11/20/2024 15:06:12 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Release\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\main.c LARGE OPTIMIZE(8,SIZE) BROWSE INTVECTOR(0X000C) INCDIR
                    -(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listin
                    -gs\main.lst) OBJECT(.\Release\Objects\main.obj)

line level    source

   1          /**
   2           ******************************************************************************
   3           * @file    main.c
   4           * @author  HUGE-IC Application Team
   5           * @version V1.0.0
   6           * @date    05-11-2022
   7           * @brief   Main program body
   8           ******************************************************************************
   9           * @attention
  10           *
  11           * <h2><center>&copy; COPYRIGHT 2021 HUGE-IC</center></h2>
  12           *
  13           * ç‰ˆæƒè¯´æ˜ŽåŽç»­è¡¥ä¸Š
  14           *
  15           ******************************************************************************
  16           */
  17          
  18          /* Includes ------------------------------------------------------------------*/
  19          #include "include.h"
  20          
  21          /** @addtogroup Template_Project
  22           * @{
  23           */
  24          
  25          /* Private typedef -----------------------------------------------------------*/
  26          /* Private define ------------------------------------------------------------*/
  27          /* Private macro -------------------------------------------------------------*/
  28          /* Private variables ---------------------------------------------------------*/
  29          /* Private function prototypes -----------------------------------------------*/
  30          /* Private functions ---------------------------------------------------------*/
  31          
  32          /**
  33           * @brief  Main program.
  34           * @param  None
  35           * @retval None
  36           */
  37          // extern u32 test_val; // æµ‹è¯•ç”¨
  38          
  39          // enum
  40          // {
  41          //     CUR_SCAN_ENGINE_SPEED, // å½“å‰è¦æ‰«æå¼•æ“Žé€Ÿåº¦
  42          //     CUR_SCAN_SPEED, // å½“å‰è¦æ‰«ææ—¶é€Ÿ
  43          // }
  44          
  45          // æ›´æ–°æ—¶é—´
  46          void time_update(void)
  47          {
  48   1          if (tmr4_cnt >= 1000) // å¦‚æžœè®¡æ—¶æ»¡1s(1000ms)
  49   1          {
  50   2              tmr4_cnt -= 1000;
  51   2      
  52   2              if (fun_info.save_info.time_sec < 59) // æœ€å¤§åŠ åˆ°59sï¼Œæµ‹è¯•é€šè¿‡
  53   2              {
C51 COMPILER V9.60.7.0   MAIN                                                              11/20/2024 15:06:12 PAGE 2   

  54   3                  fun_info.save_info.time_sec++;
  55   3              }
  56   2              else
  57   2              {
  58   3                  fun_info.save_info.time_sec = 0;
  59   3                  fun_info_save(); // æ¯åˆ†é’Ÿä¿å­˜ä¸€æ¬¡æ—¶é—´åˆ°flash
  60   3      
  61   3                  // printf("cur min %d \n", (u16)fun_info.time_min);
  62   3      
  63   3                  if (fun_info.save_info.time_min < 59) // æœ€å¤§åŠ åˆ°59minï¼Œæµ‹è¯•é€šè¿‡
  64   3                  {
  65   4                      fun_info.save_info.time_min++;
  66   4                  }
  67   3                  else
  68   3                  {
  69   4                      fun_info.save_info.time_min = 0;
  70   4                      // printf("cur hour %d \n", (u16)fun_info.time_hour);
  71   4      
  72   4                      if (fun_info.save_info.time_hour < 23) // æœ€å¤§åŠ åˆ°23hï¼Œæµ‹è¯•é€šè¿‡
  73   4                      {
  74   5                          fun_info.save_info.time_hour++;
  75   5                      }
  76   4                      else
  77   4                      {
  78   5                          fun_info.save_info.time_hour = 0;
  79   5                          fun_info.save_info.time_min = 0;
  80   5                          fun_info.save_info.time_sec = 0;
  81   5                      }
  82   4                  }
  83   3              }
  84   2      
  85   2      #if USE_MY_DEBUG
  86   2              // printf("cur sec %d \n", (u16)fun_info.time_sec);
  87   2      
  88   2              // æµ‹è¯•ç”¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹æ•°æ®ï¼Œç„¶åŽå‘é€
  89   2              {
  90   3                  /*
  91   3                      #define TEST_SEND_BATTERY // æµ‹è¯•é€šè¿‡
  92   3                      #define TEST_SEND_BRAKE // MP5ä¸Šé¢æ²¡æœ‰æ˜¾ç¤ºï¼Œä¸²å£æœ‰å‘é€å¯¹åº”çš„æ•°æ®
  93   3                      #define TEST_SEND_LEFT_TURN // æµ‹è¯•é€šè¿‡
  94   3                      #define TEST_SEND_RIGHT_TURN // æµ‹è¯•é€šè¿‡
  95   3                      #define TEST_SEND_HIGH_BEAM // æµ‹è¯•é€šè¿‡
  96   3      
  97   3                      #define TEST_SEND_SPEED // æµ‹è¯•é€šè¿‡ï¼Œä½†æ˜¯è¦æ³¨æ„æ—¶é€Ÿçš„æ˜¾ç¤ºèŒƒå›´
  98   3                      #define TEST_SEND_ENGINE_SPEED // æµ‹è¯•é€šè¿‡
  99   3                      #define TEST_SEND_FUEL // æµ‹è¯•é€šè¿‡
 100   3      
 101   3                      #define TEST_SEND_TEMP_OF_WATER // æ²¡æœ‰æ˜¾ç¤ºï¼Œæ”¹ç”¨æ°´æ¸©æŠ¥è­¦
 102   3                      #define TEST_SEND_TOTAL_MILEAGE // æµ‹è¯•é€šè¿‡
 103   3                      #define TEST_SEND_SUBTOTAL_MILEAGE // æµ‹è¯•é€šè¿‡
 104   3      
 105   3                      #define TEST_SEND_TOUCH_KEY
 106   3                      #define TEST_SEND_TEMP_OF_WATER_WARNING // æµ‹è¯•é€šè¿‡
 107   3                      #define TEST_SEND_VOLTAGE_OF_BATTERY // æµ‹è¯•é€šè¿‡
 108   3                  */
 109   3      
 110   3                  // #define TEST_SEND_VOLTAGE_OF_BATTERY
 111   3      
 112   3      #ifdef TEST_SEND_BATTERY
                          // =============================================
                          // æµ‹è¯•å‘é€ç”µæ± ç”µé‡--å•ä½ï¼šç™¾åˆ†æ¯”
                          if (fun_info.battery < 100)
C51 COMPILER V9.60.7.0   MAIN                                                              11/20/2024 15:06:12 PAGE 3   

                          {
                              fun_info.battery++;
                          }
                          else
                          {
                              fun_info.battery = 0;
                          }
              
                          // printf("cur battery %d \%\n", (u16)fun_info.battery);
                          flag_get_battery = 1;
              #endif
 127   3      
 128   3      #ifdef TEST_SEND_BRAKE
                          // =============================================
                          // æµ‹è¯•å‘é€ åˆ¹è½¦çŠ¶æ€
                          if (fun_info.brake)
                          {
                              fun_info.brake = 0;
                          }
                          else
                          {
                              fun_info.brake = 1;
                          }
              
                          flag_get_brake = 1;
              #endif
 142   3      
 143   3      #ifdef TEST_SEND_LEFT_TURN
                          // =============================================
                          // æµ‹è¯•å‘é€ å·¦è½¬å‘ç¯
                          if (fun_info.left_turn)
                          {
                              fun_info.left_turn = 0;
                          }
                          else
                          {
                              fun_info.left_turn = 1;
                          }
              
                          flag_get_left_turn = 1;
              #endif
 157   3      
 158   3      #ifdef TEST_SEND_RIGHT_TURN
                          // =============================================
                          // æµ‹è¯•å‘é€ å³è½¬å‘ç¯
                          if (fun_info.right_turn)
                          {
                              fun_info.right_turn = 0;
                          }
                          else
                          {
                              fun_info.right_turn = 1;
                          }
              
                          flag_get_right_turn = 1;
              #endif
 172   3      
 173   3      #ifdef TEST_SEND_HIGH_BEAM
                          // #if 1
                          // =============================================
                          // æµ‹è¯•å‘é€ è¿œå…‰ç¯ çŠ¶æ€
                          if (fun_info.high_beam)
C51 COMPILER V9.60.7.0   MAIN                                                              11/20/2024 15:06:12 PAGE 4   

                          {
                              fun_info.high_beam = 0;
                          }
                          else
                          {
                              fun_info.high_beam = 1;
                          }
              
                          flag_get_high_beam = 1;
              #endif
 188   3      
 189   3      #ifdef TEST_SEND_SPEED
                          // =============================================
                          // æµ‹è¯•å‘é€ æ—¶é€Ÿ
                          if (fun_info.speed < 0xFFFF)
                          {
                              fun_info.speed++;
                          }
                          else
                          {
                              fun_info.speed = 0;
                          }
              
                          flag_get_speed = 1;
              #endif
 203   3      
 204   3      #ifdef TEST_SEND_ENGINE_SPEED
                          // =============================================
                          // æµ‹è¯•å‘é€ å‘åŠ¨æœºè½¬é€Ÿ
                          if (fun_info.engine_speeed < (0xFFFF - 1000))
                          {
                              fun_info.engine_speeed += 1000;
                          }
                          else
                          {
                              fun_info.engine_speeed = 1000;
                          }
              
                          flag_get_engine_speed = 1;
              #endif
 218   3      
 219   3      #ifdef TEST_SEND_FUEL
                          // =============================================
                          // æµ‹è¯•å‘é€ æ²¹é‡
                          if (fun_info.fuel < 0xFF)
                          {
                              fun_info.fuel++;
                          }
                          else
                          {
                              fun_info.fuel = 0;
                          }
              
                          flag_get_fuel = 1;
              
              #endif
 234   3      
 235   3      #ifdef TEST_SEND_TEMP_OF_WATER
                          // =============================================
                          // æµ‹è¯•å‘é€ æ°´æ¸©
                          if (fun_info.temp_of_water < 0xFF)
                          {
C51 COMPILER V9.60.7.0   MAIN                                                              11/20/2024 15:06:12 PAGE 5   

                              fun_info.temp_of_water++;
                          }
                          else
                          {
                              fun_info.temp_of_water = 0;
                          }
              
                          flag_get_temp_of_water = 1;
              #endif
 249   3      
 250   3      #ifdef TEST_SEND_TOTAL_MILEAGE
                          // =============================================
                          // æµ‹è¯•å‘é€ å¤§è®¡é‡Œç¨‹
                          // fun_info.save_info.total_mileage = 90000;
                          if (fun_info.save_info.total_mileage < (0xFFFFFFFF - 1000))
                          {
                              fun_info.save_info.total_mileage += 1000;
                          }
                          else
                          {
                              fun_info.save_info.total_mileage = 0xFFFF0000;
                          }
              
                          flag_get_total_mileage = 1;
              
              #endif
 266   3      
 267   3      #ifdef TEST_SEND_SUBTOTAL_MILEAGE
                          // =============================================
                          // æµ‹è¯•å‘é€ å°è®¡é‡Œç¨‹
                          if (fun_info.save_info.subtotal_mileage < 1000)
                          {
                              fun_info.save_info.subtotal_mileage++;
                          }
                          else
                          {
                              fun_info.save_info.subtotal_mileage = 0;
                          }
              
                          flag_get_sub_total_mileage = 1;
              #endif
 281   3      
 282   3      #ifdef TEST_SEND_TEMP_OF_WATER_WARNING
                          // =============================================
                          // æµ‹è¯•å‘é€ æ°´æ¸©æŠ¥è­¦
              
                          if (fun_info.flag_is_in_water_temp_warning)
                          {
                              fun_info.flag_is_in_water_temp_warning = 0;
                          }
                          else
                          {
                              fun_info.flag_is_in_water_temp_warning = 1;
                          }
              
                          flag_set_temp_of_water_warning = 1;
              #endif
 297   3      
 298   3      #ifdef TEST_SEND_VOLTAGE_OF_BATTERY
                          // æµ‹è¯• å‘é€ç”µæ± ç”µåŽ‹
                          if (fun_info.voltage_of_battery < (0xFFFF - 10))
                          {
C51 COMPILER V9.60.7.0   MAIN                                                              11/20/2024 15:06:12 PAGE 6   

                              fun_info.voltage_of_battery += 10;
                          }
                          else
                          {
                              fun_info.voltage_of_battery = 10000;
                          }
              
                          flag_get_voltage_of_battery = 1;
              #endif
 311   3              }
 312   2      
 313   2      #endif
 314   2          }
 315   1      }
 316          
 317          void main(void)
 318          {
 319   1          // çœ‹é—¨ç‹—é»˜è®¤æ‰“å¼€, å¤ä½æ—¶é—´2s
 320   1          system_init();
 321   1      
 322   1          WDT_KEY = WDT_KEY_VAL(0xDD); //  å…³é—­çœ‹é—¨ç‹—
 323   1      
 324   1          // å…³é—­HCKå’ŒHDAçš„è°ƒè¯•åŠŸèƒ½
 325   1          WDT_KEY = 0x55;  // è§£é™¤å†™ä¿æŠ¤
 326   1          IO_MAP &= ~0x01; // æ¸…é™¤è¿™ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œå®žçŽ°å…³é—­HCKå’ŒHDAå¼•è„šçš„è°ƒè¯•åŠŸèƒ½ï¼ˆè§£é™¤æ
             -˜ å°„ï¼‰
 327   1          WDT_KEY = 0xBB;
 328   1      
 329   1          /* ç”¨æˆ·ä»£ç åˆå§‹åŒ–æŽ¥å£ */
 330   1          // user_init();
 331   1          {                    // user_init();
 332   2              fun_info_init(); // åˆå§‹åŒ–ç”¨äºŽå­˜æ”¾ä¿¡æ¯çš„å˜é‡
 333   2      
 334   2              tmr0_config();           // ä¸²å£æ£€æµ‹æ•°æ®è¶…æ—¶éœ€è¦ä½¿ç”¨åˆ°çš„å®šæ—¶å™¨
 335   2              uart0_config();          // å‘é€å’ŒæŽ¥æ”¶æŒ‡ä»¤ä½¿ç”¨åˆ°çš„ä¸²å£
 336   2              pin_level_scan_config(); // åˆ¹è½¦ã€è½¬å‘ç¯ã€æŒ¡ä½çš„æ£€æµ‹å¼•è„šé…ç½®
 337   2      
 338   2              tmr1_config(); // æ£€æµ‹ä¸€æ®µæ—¶é—´å†…çš„è„‰å†²ä¸ªæ•°æ‰€éœ€çš„å®šæ—¶å™¨
 339   2              // tmr2_pwm_config(); // æµ‹è¯•ç”¨çš„PWM
 340   2              speed_scan_config();        // æ—¶é€Ÿæ‰«æçš„é…ç½®
 341   2              engine_speed_scan_config(); // å‘åŠ¨æœºè½¬é€Ÿæ‰«æçš„é…ç½®
 342   2      
 343   2              tmr3_config();     // å®šæ—¶å°†é‡Œç¨‹å†™å…¥flashæ‰€éœ€çš„å®šæ—¶å™¨
 344   2              tmr4_cnt_config(); // é…ç½®ç”¨äºŽåŽå°æ›´æ–°æ—¶é—´çš„å®šæ—¶å™¨ï¼ˆæ—¶é’Ÿé»˜è®¤æ‰“å¼€ï¼‰
 345   2      
 346   2              p03_output_config(); // è¾“å‡ºé«˜ç”µå¹³ç”¨çš„å¼•è„šï¼Œåˆ°æ—¶å€™æ£€æµ‹acc,æ‰è¾“å‡ºé«˜ç”µå¹³ï¼ŒçŽ°å
             -œ¨å®ƒä¸€å¼€å§‹å°±æ˜¯é«˜ç”µå¹³
 347   2              P03 = 1;             // è¾“å‡ºé«˜ç”µå¹³ï¼Œä½¿èƒ½å±å¹•æ˜¾ç¤º
 348   2      
 349   2              adc_pin_config();
 350   2          } // user_init();
 351   1      
 352   1      #if USE_MY_DEBUG
 353   1          // æµ‹è¯•ç”¨ï¼Œä¸€ä¸Šç”µæ‰“å°flashä¸­å­˜æ”¾çš„ä¿¡æ¯
 354   1          printf("year %d month %d day %d \n", (u16)fun_info.save_info.year, (u16)fun_info.save_info.month, (u16
             -)fun_info.save_info.day);
 355   1      #endif
 356   1      
 357   1      #if 0// æµ‹è¯•å‘é€æ—¥æœŸå’Œæ—¶é—´
              //     // å½“å‰æ—¥æœŸ
              //     fun_info.save_info.year = 2024;
              //     fun_info.save_info.month = 0x0B;
C51 COMPILER V9.60.7.0   MAIN                                                              11/20/2024 15:06:12 PAGE 7   

              //     fun_info.save_info.day = 0x0A;
              
              // #if USE_MY_DEBUG
              //     printf("year %d month %d day %d \n", (u16)fun_info.save_info.year, (u16)fun_info.save_info.month, (
             -u16)fun_info.save_info.day);
              // #endif
              
                  // // å½“å‰æ—¶é—´
                  // fun_info.save_info.time_hour = 21;
                  // fun_info.save_info.time_min = 45;
                  // fun_info.save_info.time_sec = 55;
              #endif
 372   1      
 373   1          /* æŒ‰é”®åˆå§‹åŒ– */
 374   1          // tk_param_init();
 375   1      
 376   1          // P1_MD0 &= (~GPIO_P11_MODE_SEL(0x3));
 377   1          // P1_MD0 |= GPIO_P11_MODE_SEL(0x1); // è¾“å‡ºæ¨¡å¼
 378   1          // FOUT_S11 |= GPIO_FOUT_AF_FUNC;
 379   1      
 380   1          /* ç³»ç»Ÿä¸»å¾ªçŽ¯ */
 381   1          while (1)
 382   1          {
 383   2              /* æŒ‰é”®æ‰«æå‡½æ•° */
 384   2              // __tk_scan(); // ä½¿ç”¨äº†åº“é‡Œé¢çš„æŽ¥å£ï¼ˆé—­æºåº“ï¼‰
 385   2      
 386   2              /* ç”¨æˆ·å¾ªçŽ¯æ‰«æå‡½æ•°æŽ¥å£ */
 387   2              // touch_key_scan();
 388   2      
 389   2              // æ‰«æçŠ¶æ€æ˜¯å¦å˜åŒ–ï¼Œå¦‚æžœå˜åŒ–åˆ™æ›´æ–°æ ‡å¿—ä½ï¼Œæ›´æ–°çŠ¶æ€çš„ä¿¡æ¯åˆ°ç»“æž„ä½“ä¸
             -­
 390   2              // pin_level_scan();
 391   2              // speed_scan();        // æ‰«æå½“å‰æ—¶é€Ÿ
 392   2              // engine_speed_scan(); // æ‰«æå½“å‰å‘åŠ¨æœºè½¬é€Ÿ
 393   2              // adc_scan(); // adcæ‰«æï¼Œå¹¶è½¬æ¢æˆç™¾åˆ†æ¯”çš„å½¢å¼å‘é€
 394   2              // mileage_scan(); // é‡Œç¨‹æ‰«æï¼ˆå¤§è®¡é‡Œç¨‹æ‰«æ+å°è®¡é‡Œç¨‹æ‰«æï¼‰
 395   2      
 396   2              // 1. æµ‹è¯• ä»Žä¸²å£æŽ¥æ”¶æŒ‡ä»¤ï¼Œæ˜¯å¦èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«
 397   2              {
 398   3                  uart0_scan_handle();  // æ£€æŸ¥ä¸²å£æŽ¥æ”¶ç¼“å†²åŒºçš„æ•°æ®æ˜¯å¦ç¬¦åˆåè®®,å¦‚æžœæœ‰æ­£ç¡
             -®çš„æŒ‡ä»¤ï¼Œä¼šå­˜åˆ°å¦ä¸€ä¸ªç¼“å†²åŒºä¸­
 399   3                  instruction_scan();   // æ‰«ææ˜¯å¦æœ‰åˆæ³•çš„æŒ‡ä»¤
 400   3                  instruction_handle(); // æ‰«ææ˜¯å¦æœ‰å¯¹åº”çš„èŽ·å–/çŠ¶æ€æ›´æ–°æ“ä½œ
 401   3              }
 402   2      
 403   2              // 2. æµ‹è¯• æ—¶é€Ÿå’Œå‘åŠ¨æœºçš„è½¬é€Ÿçš„æ‰«æï¼Œå¹¶ä¸”ä¸ä¼šé˜»å¡žä¸»å¾ªçŽ¯
 404   2              // æ³¨æ„è¦å…ˆæ‰“å¼€å¯¹åº”çš„å®šæ—¶å™¨
 405   2              // {
 406   2              //     engine_speed_scan(); // æ£€æµ‹å‘åŠ¨æœºè½¬é€Ÿ
 407   2              //     speed_scan();        // æ£€æµ‹æ—¶é€Ÿ
 408   2              //     mileage_scan();      // æ£€æµ‹å¤§è®¡é‡Œç¨‹å’Œå°è®¡é‡Œç¨‹
 409   2              // }
 410   2      
 411   2              // æ³¨æ„è¦å…ˆæ‰“å¼€å¯¹åº”çš„å®šæ—¶å™¨:
 412   2              time_update(); // æ›´æ–°æ—¶é—´
 413   2          }
 414   1      }
 415          
 416          /**
 417           * @}
 418           */
 419          
C51 COMPILER V9.60.7.0   MAIN                                                              11/20/2024 15:06:12 PAGE 8   

 420          /*************************** (C) COPYRIGHT 2022 HUGE-IC ***** END OF FILE *****/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    224    ----
   CONSTANT SIZE    =     26    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
