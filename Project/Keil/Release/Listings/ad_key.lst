C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE AD_KEY
OBJECT MODULE PLACED IN .\Release\Objects\ad_key.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\ad_key.c LARGE OPTIMIZE(8,SIZE) BROWSE INTVECTOR(0X000C) INCD
                    -IR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\List
                    -ings\ad_key.lst) OBJECT(.\Release\Objects\ad_key.obj)

line level    source

   1          #include "ad_key.h"
   2          
   3          // è‡ªå®šä¹‰adæŒ‰é”®çš„é”®å€¼:
   4          enum
   5          {
   6              AD_KEY_ID_ONE_LEFT = 0x01,
   7              AD_KEY_ID_TWO_LEFT,
   8              AD_KEY_ID_THREE_LEFT,
   9              AD_KEY_ID_ONE_RIGHT,
  10              AD_KEY_ID_TWO_RIGHT,
  11              AD_KEY_ID_THREE_RIGHT,
  12          };
  13          
  14          // å®šä¹‰æŒ‰é”®æ‰«æå‡½æ•°ä¸­ï¼Œå„ä¸ªæ‰«æçŠ¶æ€ï¼š
  15          enum
  16          {
  17              AD_KEY_SCAN_STATUS_NONE,                  // ç©ºçŠ¶æ€ï¼Œæ£€æµ‹æ˜¯å¦æœ‰æŒ‰é”®æŒ‰ä¸‹
  18              AD_KEY_SCAN_STATUS_IS_DETECT_LOOG_PRESS,  // æ­£åœ¨æ£€æµ‹æ˜¯å¦ä¸ºé•¿æŒ‰ï¼ˆè¦è·Ÿæ£€æµ‹é•¿æŒ‰ä½œåŒºåˆ†
             -ï¼‰
  19              AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰
  20              AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰æŒç»­ï¼ˆä¸æ¾æ‰‹ï¼‰
  21              AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS, // æ­£åœ¨å¤„ç†çŸ­æŒ‰
  22          
  23              AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE, // æ­£åœ¨ç­‰å¾…çŸ­æŒ‰æ¾å¼€
  24              AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE,  // æ­£åœ¨ç­‰å¾…é•¿æŒ‰æ¾å¼€
  25              AD_KEY_SCAN_STATUS_IS_END,                      // æ”¶å°¾å¤„ç†
  26          };
  27          static volatile u8 ad_key_scan_status = 0; // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°ä¸­ï¼Œä½¿ç”¨çš„çŠ¶æ€æœº
  28          
  29          // å­˜æ”¾æŒ‰é”®å¯¹åº”çš„adå€¼:
  30          static const u16 ad_key_scan_table[][2] = {
  31              // [][0]æŒ‰é”®å¯¹åº”çš„æ ‡å·,åœ¨åˆ¤æ–­æŒ‰é”®é”®å€¼æ—¶ä½¿ç”¨   [][1]æŒ‰é”®å¯¹åº”çš„adå€¼
  32              {AD_KEY_ID_ONE_LEFT, AD_KEY_ONE_LEFT_VAL},
  33              {AD_KEY_ID_TWO_LEFT, AD_KEY_TWO_LEFT_VAL},
  34              {AD_KEY_ID_THREE_LEFT, AD_KEY_THREE_LEFT_VAL},
  35              {AD_KEY_ID_ONE_RIGHT, AD_KEY_ONE_RIGHT_VAL},
  36              {AD_KEY_ID_TWO_RIGHT, AD_KEY_TWO_RIGHT_VAL},
  37              {AD_KEY_ID_THREE_RIGHT, AD_KEY_THREE_RIGHT_VAL},
  38          };
  39          
  40          // å°†é‡‡é›†åˆ°çš„adå€¼è½¬æ¢æˆè‡ªå®šä¹‰çš„é”®å€¼
  41          static u16 __conver_cur_ad_to_ad_key(u16 cur_ad_key)
  42          {
  43   1          u8 i = 0;
  44   1          u16 ad_key_id = 0;
  45   1      
  46   1          // ARRAY_SIZE(ad_key_scan_table) è¿™é‡Œæ˜¯æ±‚å‡ºæ•°ç»„ä¸­å­˜æ”¾çš„æŒ‰é”®ä¸ªæ•°
  47   1          for (i = 0; i < ARRAY_SIZE(ad_key_scan_table); i++)
  48   1          {
  49   2              if (cur_ad_key > (ad_key_scan_table[i][1] - AD_KEY_INTERVAL) &&
  50   2                  cur_ad_key < (ad_key_scan_table[i][1] + AD_KEY_INTERVAL))
  51   2              {
  52   3                  // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®ï¼Œç°åœ¨æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 2   

  53   3                  ad_key_id = ad_key_scan_table[i][0]; // è·å–adå€¼å¯¹åº”çš„é”®å€¼
  54   3                  break;
  55   3              }
  56   2          }
  57   1      
  58   1          return ad_key_id;
  59   1      }
  60          
  61          // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°
  62          void ad_key_scan(void)
  63          {
  64   1          volatile u16 ad_key_id = 0;             // __tk_key_flag å•æ¬¡æŒ‰é”®æ ‡å¿—
  65   1          static u16 ad_key_last_id = 0;          // ç”¨äºå­˜æ”¾é•¿æŒ‰æ—¶ï¼Œå¯¹åº”çš„æŒ‰é”®
  66   1          static volatile u32 touch_time_cnt = 0; // é•¿æŒ‰è®¡æ•°å€¼
  67   1      
  68   1          /* æŒ‰é”®æ‰«æå‡½æ•° */
  69   1          ad_key_id = adc_getval(); // æ¯æ¬¡è°ƒç”¨çº¦å ç”¨370usï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡
  70   1          // printf("ad_key_id val %u\n", ad_key_id);
  71   1          ad_key_id = __conver_cur_ad_to_ad_key(ad_key_id); // å°†é‡‡é›†åˆ°çš„adå€¼è½¬æ¢æˆè‡ªå®šä¹‰çš„é”®å€¼
  72   1      
  73   1          // // æµ‹è¯•ç”¨ï¼š
  74   1          //     if (0 != ad_key_id)
  75   1          //     {
  76   1          //         printf("ad_key_id id : %u\n", ad_key_id);
  77   1          //     }
  78   1      
  79   1          if (AD_KEY_SCAN_STATUS_NONE == ad_key_scan_status) // æœªæ£€æµ‹åˆ°æŒ‰é”®æ—¶
  80   1          {
  81   2              // å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆå¹¶ä¸”ä¹‹å‰æ‰«æåˆ°çš„ä¸æ˜¯é•¿æŒ‰ï¼‰
  82   2              // åˆ¤æ–­æ˜¯å¦ä¸ºé•¿æŒ‰ï¼š
  83   2      
  84   2              if (0 == ad_key_last_id)
  85   2              {
  86   3                  // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®ï¼Œç°åœ¨æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹:
  87   3                  ad_key_last_id = ad_key_id;
  88   3              }
  89   2              else if (ad_key_last_id == ad_key_id)
  90   2              {
  91   3                  // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ç›¸ç­‰ï¼Œè¯´æ˜æŒ‰é”®è¿˜æœªæ¾å¼€
  92   3                  touch_time_cnt += (1 + ONE_CYCLE_TIME_MS);
  93   3      
  94   3                  if (touch_time_cnt >= LONG_PRESS_TIME_THRESHOLD_MS)
  95   3                  {
  96   4                      // å¦‚æœé•¿æŒ‰è¶…è¿‡äº†è®¾ç½®çš„é•¿æŒ‰æ—¶é—´
  97   4                      // è·³è½¬åˆ°é•¿æŒ‰å¤„ç†
  98   4                      touch_time_cnt = 0; // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°
  99   4      #if USE_MY_DEBUG
 100   4                      printf("long press\n"); // æµ‹è¯•ç”¨
 101   4      #endif
 102   4                      ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS;
 103   4                  }
 104   3              }
 105   2              else
 106   2              {
 107   3                  // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ä¸ç›¸ç­‰ï¼Œå¹¶ä¸”ä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä
             -¸ç­‰äº0
 108   3                  // touch_time_cnt = 0; // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°ï¼ˆå¯ä»¥ç•™åˆ°æ”¶å°¾å¤„ç†ï¼‰
 109   3      
 110   3                  // è·³è½¬åˆ°çŸ­æŒ‰å¤„ç†
 111   3                  ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS;
 112   3      #if USE_MY_DEBUG
 113   3                  printf("short press\n"); // æµ‹è¯•ç”¨
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 3   

 114   3      #endif
 115   3              }
 116   2      
 117   2              delay_ms(1); //
 118   2          }
 119   1      
 120   1          if (AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS == ad_key_scan_status)
 121   1          {
 122   2              // å¦‚æœæ˜¯æ­£åœ¨å¤„ç†çŸ­æŒ‰
 123   2              if (AD_KEY_ID_ONE_LEFT == ad_key_last_id)
 124   2              {
 125   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 126   3      #if USE_MY_DEBUG
 127   3                  printf("one left press\n");
 128   3      #endif
 129   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_INC);
 130   3              }
 131   2              else if (AD_KEY_ID_TWO_LEFT == ad_key_last_id)
 132   2              {
 133   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 134   3      #if USE_MY_DEBUG
 135   3                  printf("two left press\n");
 136   3      #endif
 137   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MUTE);
 138   3              }
 139   2              else if (AD_KEY_ID_THREE_LEFT == ad_key_last_id)
 140   2              {
 141   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 142   3      #if USE_MY_DEBUG
 143   3                  printf("three left press\n");
 144   3      #endif
 145   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_DEC);
 146   3              }
 147   2              else if (AD_KEY_ID_ONE_RIGHT == ad_key_last_id)
 148   2              {
 149   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 150   3      #if USE_MY_DEBUG
 151   3                  printf("one right press\n");
 152   3      #endif
 153   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_NEXT);
 154   3              }
 155   2              else if (AD_KEY_ID_TWO_RIGHT == ad_key_last_id)
 156   2              {
 157   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 158   3      #if USE_MY_DEBUG
 159   3                  printf("two right press\n");
 160   3      #endif
 161   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MODE);
 162   3              }
 163   2              else if (AD_KEY_ID_THREE_RIGHT == ad_key_last_id)
 164   2              {
 165   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 166   3      #if USE_MY_DEBUG
 167   3                  printf("three right press\n");
 168   3      #endif
 169   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_PRE);
 170   3              }
 171   2              else
 172   2              {
 173   3                  // å¦‚æœæ²¡æœ‰æŒ‰é”®è¢«è§¦æ‘¸
 174   3              }
 175   2      
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 4   

 176   2              ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE;
 177   2          }
 178   1      
 179   1          if (AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS == ad_key_scan_status)
 180   1          {
 181   2              // å¤„ç†é•¿æŒ‰
 182   2              if (AD_KEY_ID_ONE_LEFT == ad_key_last_id)
 183   2              {
 184   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 185   3      #if USE_MY_DEBUG
 186   3                  // printf("one left long press\n");
 187   3      #endif
 188   3                  // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
 189   3              }
 190   2              else if (AD_KEY_ID_TWO_LEFT == ad_key_last_id)
 191   2              {
 192   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 193   3      #if USE_MY_DEBUG
 194   3                  printf("two left long press\n");
 195   3      #endif
 196   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_POWER);
 197   3              }
 198   2              else if (AD_KEY_ID_THREE_LEFT == ad_key_last_id)
 199   2              {
 200   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 201   3      #if USE_MY_DEBUG
 202   3                  // printf("three left long press\n");
 203   3      #endif
 204   3                  // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
 205   3              }
 206   2              else if (AD_KEY_ID_ONE_RIGHT == ad_key_last_id)
 207   2              {
 208   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 209   3      #if USE_MY_DEBUG
 210   3                  // printf("one right long press\n");
 211   3      #endif
 212   3                  // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
 213   3              }
 214   2              else if (AD_KEY_ID_TWO_RIGHT == ad_key_last_id)
 215   2              {
 216   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 217   3      #if USE_MY_DEBUG
 218   3                  printf("two right long press\n");
 219   3      #endif
 220   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MAIN);
 221   3              }
 222   2              else if (AD_KEY_ID_THREE_RIGHT == ad_key_last_id)
 223   2              {
 224   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 225   3      
 226   3      #if USE_MY_DEBUG
 227   3                  // printf("three right long press\n");
 228   3      #endif
 229   3                  // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
 230   3              }
 231   2      
 232   2              ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS; // è·³è½¬åˆ°é•¿æŒ‰æŒç»­
 233   2          }
 234   1      
 235   1          if (AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS == ad_key_scan_status)
 236   1          {
 237   2              // å¤„ç†é•¿æŒ‰æŒç»­
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 5   

 238   2      
 239   2              if (ad_key_last_id == ad_key_id)
 240   2              {
 241   3                  touch_time_cnt++;
 242   3                  if (AD_KEY_ID_ONE_LEFT == ad_key_last_id)
 243   3                  {
 244   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 245   4                      {
 246   5                          touch_time_cnt = 0;
 247   5      #if USE_MY_DEBUG
 248   5                          printf("one left continue press\n");
 249   5      #endif
 250   5                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_INC);
 251   5                      }
 252   4                  }
 253   3                  else if (AD_KEY_ID_TWO_LEFT == ad_key_last_id)
 254   3                  {
 255   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 256   4                      {
 257   5                          touch_time_cnt = 0;
 258   5      #if USE_MY_DEBUG
 259   5                          // printf("two left continue press\n");
 260   5      #endif
 261   5                          // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
 262   5                      }
 263   4                  }
 264   3                  else if (AD_KEY_ID_THREE_LEFT == ad_key_last_id)
 265   3                  {
 266   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 267   4                      {
 268   5                          touch_time_cnt = 0;
 269   5      #if USE_MY_DEBUG
 270   5                          // printf("three left continue press\n");
 271   5      #endif
 272   5                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_DEC);
 273   5                      }
 274   4                  }
 275   3                  else if (AD_KEY_ID_ONE_RIGHT == ad_key_last_id)
 276   3                  {
 277   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 278   4                      {
 279   5                          touch_time_cnt = 0;
 280   5      #if USE_MY_DEBUG
 281   5                          // printf("one right continue press\n");
 282   5      #endif
 283   5                          // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
 284   5                      }
 285   4                  }
 286   3                  else if (AD_KEY_ID_TWO_RIGHT == ad_key_last_id)
 287   3                  {
 288   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 289   4                      {
 290   5                          touch_time_cnt = 0;
 291   5      #if USE_MY_DEBUG
 292   5                          // printf("two right continue press\n");
 293   5      #endif
 294   5                          // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
 295   5                      }
 296   4                  }
 297   3                  else if (AD_KEY_ID_THREE_RIGHT == ad_key_last_id)
 298   3                  {
 299   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 6   

 300   4                      {
 301   5                          touch_time_cnt = 0;
 302   5      #if USE_MY_DEBUG
 303   5                          // printf("three right continue press\n");
 304   5      #endif
 305   5                          // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
 306   5                      }
 307   4                  }
 308   3      
 309   3                  delay_ms(1);
 310   3              }
 311   2              else
 312   2              {
 313   3                  // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸å½“å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸ä¸€è‡´ï¼Œ
 314   3                  // è¯´æ˜ å¯èƒ½æ¾å¼€äº†æ‰‹ æˆ–æ˜¯ ä¸€åªæ‰‹æŒ‰ä½äº†åŸæ¥çš„æŒ‰é”®å¦ä¸€åªæ‰‹æŒ‰äº†å…¶ä»–æ
             -Œ‰é”®
 315   3      
 316   3                  // è·³è½¬åˆ°ç­‰å¾…é•¿æŒ‰æ¾å¼€
 317   3                  ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE;
 318   3              }
 319   2          }
 320   1      
 321   1          if ((AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == ad_key_scan_status) ||
 322   1              (AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE == ad_key_scan_status))
 323   1          {
 324   2              // å¦‚æœæ˜¯ç­‰å¾…æŒ‰é”®æ¾å¼€
 325   2              static volatile u16 loose_cnt = 0; // å­˜æ”¾æ¾æ‰‹è®¡æ•°å€¼
 326   2      
 327   2              if (0 == ad_key_id)
 328   2              {
 329   3                  // å¦‚æœå½“å‰æ£€æµ‹åˆ°ä¸€æ¬¡é”®å€¼idä¸ºç©º
 330   3                  loose_cnt++;
 331   3                  delay_ms(1);
 332   3              }
 333   2              else
 334   2              {
 335   3                  // åªè¦æœ‰ä¸€æ¬¡æ£€æµ‹åˆ°æŒ‰é”®ï¼Œè¯´æ˜æ²¡æœ‰æ¾å¼€æ‰‹
 336   3                  loose_cnt = 0;
 337   3              }
 338   2      
 339   2              if (loose_cnt >= LOOSE_PRESS_CNT_MS) // è¿™é‡Œçš„æ¯”è¾ƒå€¼éœ€è¦æ³¨æ„ï¼Œä¸èƒ½å¤§äºå˜é‡ç±»å‹å
             -¯¹åº”çš„æœ€å¤§å€¼
 340   2              {
 341   3                  loose_cnt = 0; // æ¸…ç©ºæ¾æ‰‹è®¡æ•°
 342   3                  // å¦‚æœ xx mså†…æ²¡æœ‰æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹ï¼Œè¯´æ˜å·²ç»æ¾å¼€æ‰‹
 343   3      
 344   3                  if (AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == ad_key_scan_status)
 345   3                  {
 346   4                      if (AD_KEY_ID_ONE_LEFT == ad_key_last_id)
 347   4                      {
 348   5      #if USE_MY_DEBUG
 349   5                          // printf("one left long press loose\n");
 350   5      #endif
 351   5                      }
 352   4                      else if (AD_KEY_ID_TWO_LEFT == ad_key_last_id)
 353   4                      {
 354   5      #if USE_MY_DEBUG
 355   5                          // printf("two left long press loose\n");
 356   5      #endif
 357   5                      }
 358   4                      else if (AD_KEY_ID_THREE_LEFT == ad_key_last_id)
 359   4                      {
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 7   

 360   5      #if USE_MY_DEBUG
 361   5                          // printf("three left long press loose\n");
 362   5      #endif
 363   5                      }
 364   4                      else if (AD_KEY_ID_ONE_RIGHT == ad_key_last_id)
 365   4                      {
 366   5      #if USE_MY_DEBUG
 367   5                          // printf("one right long press loose\n");
 368   5      #endif
 369   5                      }
 370   4                      else if (AD_KEY_ID_TWO_RIGHT == ad_key_last_id)
 371   4                      {
 372   5      #if USE_MY_DEBUG
 373   5                          // printf("two right long press loose\n");
 374   5      #endif
 375   5                      }
 376   4                      else if (AD_KEY_ID_THREE_RIGHT == ad_key_last_id)
 377   4                      {
 378   5      #if USE_MY_DEBUG
 379   5                          // printf("three right long press loose\n");
 380   5      #endif
 381   5                      }
 382   4                  }
 383   3      
 384   3                  ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_END; // è·³è½¬åˆ°æ”¶å°¾å¤„ç†
 385   3              }
 386   2          }
 387   1      
 388   1          if (AD_KEY_SCAN_STATUS_IS_END == ad_key_scan_status)
 389   1          {
 390   2              // æ”¶å°¾å¤„ç†
 391   2              ad_key_id = 0;
 392   2              ad_key_last_id = 0;
 393   2              touch_time_cnt = 0;
 394   2      
 395   2              ad_key_scan_status = AD_KEY_SCAN_STATUS_NONE;
 396   2          }
 397   1      }
 398          
 399          #if 0 // æ¯æ¬¡éƒ½è¦æ¯”è¾ƒadå€¼æ˜¯å¦åœ¨é”®å€¼åŒºé—´çš„adæŒ‰é”®æ‰«æï¼š
              enum
              {
                  AD_KEY_SCAN_STATUS_NONE,                  // ç©ºçŠ¶æ€ï¼Œæ£€æµ‹æ˜¯å¦æœ‰æŒ‰é”®æŒ‰ä¸‹
                  AD_KEY_SCAN_STATUS_IS_DETECT_LOOG_PRESS,  // æ­£åœ¨æ£€æµ‹æ˜¯å¦ä¸ºé•¿æŒ‰ï¼ˆè¦è·Ÿæ£€æµ‹é•¿æŒ‰ä½œåŒºåˆ†
             -ï¼‰
                  AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰
                  AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰æŒç»­ï¼ˆä¸æ¾æ‰‹ï¼‰
                  AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS, // æ­£åœ¨å¤„ç†çŸ­æŒ‰
              
                  AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE, // æ­£åœ¨ç­‰å¾…çŸ­æŒ‰æ¾å¼€
                  AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE,  // æ­£åœ¨ç­‰å¾…é•¿æŒ‰æ¾å¼€
                  AD_KEY_SCAN_STATUS_IS_END,                      // æ”¶å°¾å¤„ç†
              };
              static volatile u8 ad_key_scan_status = 0; // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°ä¸­ï¼Œä½¿ç”¨çš„çŠ¶æ€æœº
              
              // å­˜æ”¾æŒ‰é”®å¯¹åº”çš„adå€¼:
              const u16 ad_key_scan_table[] = {
                  AD_KEY_ONE_LEFT_VAL,
                  AD_KEY_TWO_LEFT_VAL,
                  AD_KEY_THREE_LEFT_VAL,
                  AD_KEY_ONE_RIGHT_VAL,
                  AD_KEY_TWO_RIGHT_VAL,
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 8   

                  AD_KEY_THREE_RIGHT_VAL,
              };
              
              static u8 __detect_press(u16 cur_ad_key)
              {
                  u8 flag_is_detect_press = 0;
                  u8 i = 0;
                  for (i = 0; i < ARRAY_SIZE(ad_key_scan_table); i++)
                  {
                      if (cur_ad_key > (ad_key_scan_table[i] - AD_KEY_INTERVAL) &&
                          cur_ad_key < (ad_key_scan_table[i] + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®ï¼Œç°åœ¨æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹
                          flag_is_detect_press = 1;
                          break;
                      }
                  }
              
                  return flag_is_detect_press;
              }
              
              // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°
              void ad_key_scan(void)
              {
                  volatile u16 ad_key = 0;                   // __tk_key_flag å•æ¬¡æŒ‰é”®æ ‡å¿—
                  static u16 ad_key_last = 0;                // ç”¨äºå­˜æ”¾é•¿æŒ‰æ—¶ï¼Œå¯¹åº”çš„æŒ‰é”®
                  static volatile u32 touch_time_cnt = 0;    // é•¿æŒ‰è®¡æ•°å€¼
                  static u8 flag_is_detect_ad_key_press = 0; // æ ‡å¿—ä½ï¼Œæ£€æµ‹æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹
              
                  /* æŒ‰é”®æ‰«æå‡½æ•° */
                  ad_key = adc_getval(); // æ¯æ¬¡è°ƒç”¨çº¦å ç”¨370usï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡
                  // printf("ad_key val %u\n", ad_key);
              
                  if (AD_KEY_SCAN_STATUS_NONE == ad_key_scan_status) // æœªæ£€æµ‹åˆ°æŒ‰é”®æ—¶
                  {
                      // å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆå¹¶ä¸”ä¹‹å‰æ‰«æåˆ°çš„ä¸æ˜¯é•¿æŒ‰ï¼‰
                      // åˆ¤æ–­æ˜¯å¦ä¸ºé•¿æŒ‰ï¼š
              
                      if (0 == flag_is_detect_ad_key_press)
                      {
                          flag_is_detect_ad_key_press = __detect_press(ad_key);
                          if (flag_is_detect_ad_key_press)
                          {
                              // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®ï¼Œç°åœ¨æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹:
                              ad_key_last = ad_key;
                          }
                      }
              
                      if (0 == flag_is_detect_ad_key_press)
                      {
                          // æœªæ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹
                          return;
                      }
              
                      // if (flag_is_detect_ad_key_press)
                      // {
                      //     // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®ï¼Œç°åœ¨æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹
                      //     ad_key_last = ad_key;
                      // }
                      // else if (ad_key_last > (ad_key - AD_KEY_INTERVAL) &&
                      //          ad_key_last < (ad_key + AD_KEY_INTERVAL))
                      if (ad_key_last > (ad_key - AD_KEY_INTERVAL) &&
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 9   

                          ad_key_last < (ad_key + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ç›¸ç­‰ï¼Œè¯´æ˜æŒ‰é”®è¿˜æœªæ¾å¼€
                          touch_time_cnt += (1 + ONE_CYCLE_TIME_MS);
              
                          if (touch_time_cnt >= LONG_PRESS_TIME_THRESHOLD_MS)
                          {
                              // å¦‚æœé•¿æŒ‰è¶…è¿‡äº†è®¾ç½®çš„é•¿æŒ‰æ—¶é—´
                              // è·³è½¬åˆ°é•¿æŒ‰å¤„ç†
                              touch_time_cnt = 0;     // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°
                              printf("long press\n"); // æµ‹è¯•ç”¨
                              ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS;
                          }
                      }
                      else
                      {
                          // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ä¸ç›¸ç­‰ï¼Œå¹¶ä¸”ä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä
             -¸ç­‰äº0
                          // touch_time_cnt = 0; // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°ï¼ˆå¯ä»¥ç•™åˆ°æ”¶å°¾å¤„ç†ï¼‰
              
                          // è·³è½¬åˆ°çŸ­æŒ‰å¤„ç†
                          ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS;
                          printf("short press\n"); // æµ‹è¯•ç”¨
                      }
              
                      delay_ms(1); //
                  }
              
                  if (AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS == ad_key_scan_status)
                  {
                      // å¦‚æœæ˜¯æ­£åœ¨å¤„ç†çŸ­æŒ‰
                      // flag_get_touch_key_status = 1; // é»˜è®¤è·å–åˆ°äº†æŒ‰é”®çŠ¶æ€
              
                      if (ad_key_last > (AD_KEY_ONE_LEFT_VAL - AD_KEY_INTERVAL) &&
                          ad_key_last < (AD_KEY_ONE_LEFT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
                          // å¦‚æœæ²¡æœ‰æŒ‰é”®åŒå‡»ï¼Œè¯´æ˜æ˜¯çŸ­æŒ‰
              #if USE_MY_DEBUG
                          printf("one left press\n");
              #endif
                          // fun_info.touch_key_val = TOUCH_KEY_VAL_VOL_INC;
                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_INC);
                      }
                      else if (ad_key_last > (AD_KEY_TWO_LEFT_VAL - AD_KEY_INTERVAL) &&
                               ad_key_last < (AD_KEY_TWO_LEFT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
                          // å¦‚æœæ²¡æœ‰æŒ‰é”®åŒå‡»ï¼Œè¯´æ˜æ˜¯çŸ­æŒ‰
              #if USE_MY_DEBUG
                          printf("two left press\n");
              #endif
                          // fun_info.touch_key_val = TOUCH_KEY_VAL_MUTE;
                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MUTE);
                      }
                      else if (ad_key_last > (AD_KEY_THREE_LEFT_VAL - AD_KEY_INTERVAL) &&
                               ad_key_last < (AD_KEY_THREE_LEFT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 10  

              #if USE_MY_DEBUG
                          printf("three left press\n");
              #endif
                          // fun_info.touch_key_val = TOUCH_KEY_VAL_VOL_DEC;
                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_DEC);
                      }
                      else if (ad_key_last > (AD_KEY_ONE_RIGHT_VAL - AD_KEY_INTERVAL) &&
                               ad_key_last < (AD_KEY_ONE_RIGHT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          printf("one right press\n");
              #endif
                          // fun_info.touch_key_val = TOUCH_KEY_VAL_NEXT;
                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_NEXT);
                      }
                      else if (ad_key_last > (AD_KEY_TWO_RIGHT_VAL - AD_KEY_INTERVAL) &&
                               ad_key_last < (AD_KEY_TWO_RIGHT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          printf("two right press\n");
              #endif
                          // fun_info.touch_key_val = TOUCH_KEY_VAL_MODE;
                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MODE);
                      }
                      else if (ad_key_last > (AD_KEY_THREE_RIGHT_VAL - AD_KEY_INTERVAL) &&
                               ad_key_last < (AD_KEY_THREE_RIGHT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          printf("three right press\n");
              #endif
                          // fun_info.touch_key_val = TOUCH_KEY_VAL_PRE;
                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_PRE);
                      }
                      else
                      {
                          // å¦‚æœæ²¡æœ‰æŒ‰é”®è¢«è§¦æ‘¸
                          // flag_get_touch_key_status = 0; // æ¸…ç©ºè¯¥æ ‡å¿—ä½ï¼Œä¸å‘é€æŒ‰é”®çŠ¶æ€
                      }
              
                      ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE;
                  }
              
                  if (AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS == ad_key_scan_status)
                  {
                      // flag_get_touch_key_status = 1; // é»˜è®¤è·å–åˆ°äº†æŒ‰é”®çŠ¶æ€
                      // å¤„ç†é•¿æŒ‰
                      if (ad_key_last > (AD_KEY_ONE_LEFT_VAL - AD_KEY_INTERVAL) &&
                          ad_key_last < (AD_KEY_ONE_LEFT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          // printf("one left long press\n");
              #endif
                          // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
                      }
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 11  

                      else if (ad_key_last > (AD_KEY_TWO_LEFT_VAL - AD_KEY_INTERVAL) &&
                               ad_key_last < (AD_KEY_TWO_LEFT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœKEY2è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          printf("two left long press\n");
              #endif
                          // fun_info.touch_key_val = TOUCH_KEY_VAL_POWER;
                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_POWER);
                      }
                      else if (ad_key_last > (AD_KEY_THREE_LEFT_VAL - AD_KEY_INTERVAL) &&
                               ad_key_last < (AD_KEY_THREE_LEFT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          // printf("three left long press\n");
              #endif
                          // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
                      }
                      else if (ad_key_last > (AD_KEY_ONE_RIGHT_VAL - AD_KEY_INTERVAL) &&
                               ad_key_last < (AD_KEY_ONE_RIGHT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          // printf("one right long press\n");
              #endif
                          // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
                      }
                      else if (ad_key_last > (AD_KEY_TWO_RIGHT_VAL - AD_KEY_INTERVAL) &&
                               ad_key_last < (AD_KEY_TWO_RIGHT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          printf("two right long press\n");
              #endif
                          // fun_info.touch_key_val = TOUCH_KEY_VAL_MAIN;
                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MAIN);
                      }
                      else if (ad_key_last > (AD_KEY_THREE_RIGHT_VAL - AD_KEY_INTERVAL) &&
                               ad_key_last < (AD_KEY_THREE_RIGHT_VAL + AD_KEY_INTERVAL))
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          // printf("three right long press\n");
              #endif
                          // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
                      }
              
                      ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS; // è·³è½¬åˆ°é•¿æŒ‰æŒç»­
                  }
              
                  if (AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS == ad_key_scan_status)
                  {
                      // å¤„ç†é•¿æŒ‰æŒç»­
                      // flag_get_touch_key_status = 1; // é»˜è®¤è·å–åˆ°äº†æŒ‰é”®çŠ¶æ€
              
                      // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°çš„adå€¼(ad_key_last)ä¸å½“å‰æ£€æµ‹åˆ°çš„adå€¼(ad_key)åŸºæœ¬ä¸€è‡´
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 12  

                      if (ad_key_last > (ad_key - AD_KEY_INTERVAL) &&
                          ad_key_last < (ad_key + AD_KEY_INTERVAL))
                      {
                          touch_time_cnt++;
                          if (ad_key_last > (AD_KEY_ONE_LEFT_VAL - AD_KEY_INTERVAL) &&
                              ad_key_last < (AD_KEY_ONE_LEFT_VAL + AD_KEY_INTERVAL))
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  printf("one left continue press\n");
              #endif
                                  // fun_info.touch_key_val = TOUCH_KEY_VAL_VOL_INC;
                                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_INC);
                              }
                          }
                          else if (ad_key_last > (AD_KEY_TWO_LEFT_VAL - AD_KEY_INTERVAL) &&
                                   ad_key_last < (AD_KEY_TWO_LEFT_VAL + AD_KEY_INTERVAL))
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  // printf("two left continue press\n");
              #endif
                                  // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
                              }
                          }
                          else if (ad_key_last > (AD_KEY_THREE_LEFT_VAL - AD_KEY_INTERVAL) &&
                                   ad_key_last < (AD_KEY_THREE_LEFT_VAL + AD_KEY_INTERVAL))
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  // printf("three left continue press\n");
              #endif
                                  // fun_info.touch_key_val = TOUCH_KEY_VAL_VOL_DEC;
                                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_DEC);
                              }
                          }
                          else if (ad_key_last > (AD_KEY_ONE_RIGHT_VAL - AD_KEY_INTERVAL) &&
                                   ad_key_last < (AD_KEY_ONE_RIGHT_VAL + AD_KEY_INTERVAL))
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  // printf("one right continue press\n");
              #endif
                                  // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
                              }
                          }
                          else if (ad_key_last > (AD_KEY_TWO_RIGHT_VAL - AD_KEY_INTERVAL) &&
                                   ad_key_last < (AD_KEY_TWO_RIGHT_VAL + AD_KEY_INTERVAL))
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  // printf("two right continue press\n");
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 13  

              #endif
                                  // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
                              }
                          }
                          else if (ad_key_last > (AD_KEY_THREE_RIGHT_VAL - AD_KEY_INTERVAL) &&
                                   ad_key_last < (AD_KEY_THREE_RIGHT_VAL + AD_KEY_INTERVAL))
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  // printf("three right continue press\n");
              #endif
                                  // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
                              }
                          }
              
                          delay_ms(1);
                      }
                      else
                      {
                          // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸å½“å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸ä¸€è‡´ï¼Œ
                          // è¯´æ˜ å¯èƒ½æ¾å¼€äº†æ‰‹ æˆ–æ˜¯ ä¸€åªæ‰‹æŒ‰ä½äº†åŸæ¥çš„æŒ‰é”®å¦ä¸€åªæ‰‹æŒ‰äº†å…¶ä»–æ
             -Œ‰é”®
              
                          // è·³è½¬åˆ°ç­‰å¾…é•¿æŒ‰æ¾å¼€
                          ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE;
                          // flag_get_touch_key_status = 0; // æ¸…ç©ºè¯­å¥å—åˆšå¼€å§‹é»˜è®¤ç½®ä½çš„æ ‡å¿—ä½
                      }
                  }
              
                  if ((AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == ad_key_scan_status) ||
                      (AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE == ad_key_scan_status))
                  {
                      // å¦‚æœæ˜¯ç­‰å¾…æŒ‰é”®æ¾å¼€
                      static volatile u16 loose_cnt = 0; // å­˜æ”¾æ¾æ‰‹è®¡æ•°å€¼
              
                      flag_is_detect_ad_key_press = __detect_press(ad_key);
              
                      if (0 == flag_is_detect_ad_key_press)
                      {
                          loose_cnt++;
                          delay_ms(1);
                      }
                      else
                      {
                          // åªè¦æœ‰ä¸€æ¬¡æ£€æµ‹åˆ°æŒ‰é”®ï¼Œè¯´æ˜æ²¡æœ‰æ¾å¼€æ‰‹
                          loose_cnt = 0;
                      }
              
                      if (loose_cnt >= LOOSE_PRESS_CNT_MS) // è¿™é‡Œçš„æ¯”è¾ƒå€¼éœ€è¦æ³¨æ„ï¼Œä¸èƒ½å¤§äºå˜é‡ç±»å‹å
             -¯¹åº”çš„æœ€å¤§å€¼
                      {
                          loose_cnt = 0; // æ¸…ç©ºæ¾æ‰‹è®¡æ•°
                          // å¦‚æœ xx mså†…æ²¡æœ‰æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹ï¼Œè¯´æ˜å·²ç»æ¾å¼€æ‰‹
              
                          if (AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == ad_key_scan_status)
                          {
                              if (ad_key_last > (AD_KEY_ONE_LEFT_VAL - AD_KEY_INTERVAL) &&
                                  ad_key_last < (AD_KEY_ONE_LEFT_VAL + AD_KEY_INTERVAL))
                              {
              #if USE_MY_DEBUG
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 14  

                                  // printf("one left long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, ad_key1);
                              }
                              else if (ad_key_last > (AD_KEY_TWO_LEFT_VAL - AD_KEY_INTERVAL) &&
                                       ad_key_last < (AD_KEY_TWO_LEFT_VAL + AD_KEY_INTERVAL))
                              {
              #if USE_MY_DEBUG
                                  // printf("two left long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, ad_key2);
                              }
                              else if (ad_key_last > (AD_KEY_THREE_LEFT_VAL - AD_KEY_INTERVAL) &&
                                       ad_key_last < (AD_KEY_THREE_LEFT_VAL + AD_KEY_INTERVAL))
                              {
              #if USE_MY_DEBUG
                                  // printf("three left long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, ad_key3);
                              }
                              else if (ad_key_last > (AD_KEY_ONE_RIGHT_VAL - AD_KEY_INTERVAL) &&
                                       ad_key_last < (AD_KEY_ONE_RIGHT_VAL + AD_KEY_INTERVAL))
                              {
              #if USE_MY_DEBUG
                                  // printf("one right long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, ad_key4);
                              }
                              else if (ad_key_last > (AD_KEY_TWO_RIGHT_VAL - AD_KEY_INTERVAL) &&
                                       ad_key_last < (AD_KEY_TWO_RIGHT_VAL + AD_KEY_INTERVAL))
                              {
              #if USE_MY_DEBUG
                                  // printf("two right long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, ad_key5);
                              }
                              else if (ad_key_last > (AD_KEY_THREE_RIGHT_VAL - AD_KEY_INTERVAL) &&
                                       ad_key_last < (AD_KEY_THREE_RIGHT_VAL + AD_KEY_INTERVAL))
                              {
              #if USE_MY_DEBUG
                                  // printf("three right long press loose\n");
              #endif
                                  // send_status_keyval(KEY_PRESS_LOOSE, ad_key5);
                              }
                          }
              
                          ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_END; // è·³è½¬åˆ°æ”¶å°¾å¤„ç†
                      }
                  }
              
                  if (AD_KEY_SCAN_STATUS_IS_END == ad_key_scan_status)
                  {
                      // æ”¶å°¾å¤„ç†
                      ad_key = 0;
                      ad_key_last = 0;
                      touch_time_cnt = 0;
                      flag_is_detect_ad_key_press = 0;
              
                      // fun_info.touch_key_val = 0;
              
                      ad_key_scan_status = AD_KEY_SCAN_STATUS_NONE;
                  }
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/22/2024 10:24:09 PAGE 15  

              }
              
              #endif // æ¯æ¬¡éƒ½è¦æ¯”è¾ƒadå€¼æ˜¯å¦åœ¨é”®å€¼åŒºé—´çš„adæŒ‰é”®æ‰«æ


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1058    ----
   CONSTANT SIZE    =    196    ----
   XDATA SIZE       =     33       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
