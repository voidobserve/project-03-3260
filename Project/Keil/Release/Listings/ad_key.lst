C51 COMPILER V9.60.7.0   AD_KEY                                                            11/21/2024 16:13:17 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE AD_KEY
OBJECT MODULE PLACED IN .\Release\Objects\ad_key.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\ad_key.c LARGE OPTIMIZE(8,SIZE) BROWSE INTVECTOR(0X000C) INCD
                    -IR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\List
                    -ings\ad_key.lst) OBJECT(.\Release\Objects\ad_key.obj)

line level    source

   1          #include "ad_key.h"
   2          
   3          enum
   4          {
   5              AD_KEY_SCAN_STATUS_NONE,                  // ç©ºçŠ¶æ€ï¼Œæ£€æµ‹æ˜¯å¦æœ‰æŒ‰é”®æŒ‰ä¸‹
   6              AD_KEY_SCAN_STATUS_IS_DETECT_LOOG_PRESS,  // æ­£åœ¨æ£€æµ‹æ˜¯å¦ä¸ºé•¿æŒ‰ï¼ˆè¦è·Ÿæ£€æµ‹é•¿æŒ‰ä½œåŒºåˆ†
             -ï¼‰
   7              AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰
   8              AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰æŒç»­ï¼ˆä¸æ¾æ‰‹ï¼‰
   9              AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS, // æ­£åœ¨å¤„ç†çŸ­æŒ‰
  10          
  11              AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE, // æ­£åœ¨ç­‰å¾…çŸ­æŒ‰æ¾å¼€
  12              AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE,  // æ­£åœ¨ç­‰å¾…é•¿æŒ‰æ¾å¼€
  13              AD_KEY_SCAN_STATUS_IS_END,                      // æ”¶å°¾å¤„ç†
  14          };
  15          static volatile u8 ad_key_scan_status = 0; // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°ä¸­ï¼Œä½¿ç”¨çš„çŠ¶æ€æœº
  16          
  17          // å­˜æ”¾æŒ‰é”®å¯¹åº”çš„adå€¼:
  18          const u16 ad_key_scan_table[] = {
  19              AD_KEY_ONE_LEFT_VAL,
  20              AD_KEY_TWO_LEFT_VAL,
  21              AD_KEY_THREE_LEFT_VAL,
  22              AD_KEY_ONE_RIGHT_VAL,
  23              AD_KEY_TWO_RIGHT_VAL,
  24              AD_KEY_THREE_RIGHT_VAL,
  25          };
  26          
  27          static u8 __detect_press(u16 cur_ad_key)
  28          {
  29   1          u8 flag_is_detect_press = 0;
  30   1          u8 i = 0;
  31   1          for (i = 0; i < ARRAY_SIZE(ad_key_scan_table); i++)
  32   1          {
  33   2              if (cur_ad_key > (ad_key_scan_table[i] - AD_KEY_INTERVAL) &&
  34   2                  cur_ad_key < (ad_key_scan_table[i] + AD_KEY_INTERVAL))
  35   2              {
  36   3                  // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®ï¼Œç°åœ¨æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹
  37   3                  flag_is_detect_press = 1;
  38   3                  break;
  39   3              }
  40   2          }
  41   1      
  42   1          return flag_is_detect_press;
  43   1      }
  44          
  45          // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°
  46          void ad_key_scan(void)
  47          {
  48   1          volatile u16 ad_key = 0;                   // __tk_key_flag å•æ¬¡æŒ‰é”®æ ‡å¿—
  49   1          static u16 ad_key_last = 0;                // ç”¨äºå­˜æ”¾é•¿æŒ‰æ—¶ï¼Œå¯¹åº”çš„æŒ‰é”®
  50   1          static volatile u32 touch_time_cnt = 0;    // é•¿æŒ‰è®¡æ•°å€¼
  51   1          static u8 flag_is_detect_ad_key_press = 0; // æ ‡å¿—ä½ï¼Œæ£€æµ‹æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹
  52   1      
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/21/2024 16:13:17 PAGE 2   

  53   1          /* æŒ‰é”®æ‰«æå‡½æ•° */
  54   1          ad_key = adc_getval(); // æ¯æ¬¡è°ƒç”¨çº¦å ç”¨370usï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡
  55   1          // printf("ad_key val %u\n", ad_key);
  56   1      
  57   1          if (AD_KEY_SCAN_STATUS_NONE == ad_key_scan_status) // æœªæ£€æµ‹åˆ°æŒ‰é”®æ—¶
  58   1          {
  59   2              // å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆå¹¶ä¸”ä¹‹å‰æ‰«æåˆ°çš„ä¸æ˜¯é•¿æŒ‰ï¼‰
  60   2              // åˆ¤æ–­æ˜¯å¦ä¸ºé•¿æŒ‰ï¼š
  61   2      
  62   2              if (0 == flag_is_detect_ad_key_press)
  63   2              {
  64   3                  flag_is_detect_ad_key_press = __detect_press(ad_key);
  65   3                  if (flag_is_detect_ad_key_press)
  66   3                  {
  67   4                      // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®ï¼Œç°åœ¨æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹:
  68   4                      ad_key_last = ad_key;
  69   4                  }
  70   3              }
  71   2      
  72   2              if (0 == flag_is_detect_ad_key_press)
  73   2              {
  74   3                  // æœªæ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹
  75   3                  return;
  76   3              }
  77   2      
  78   2              // if (flag_is_detect_ad_key_press)
  79   2              // {
  80   2              //     // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®ï¼Œç°åœ¨æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹
  81   2              //     ad_key_last = ad_key;
  82   2              // }
  83   2              // else if (ad_key_last > (ad_key - AD_KEY_INTERVAL) &&
  84   2              //          ad_key_last < (ad_key + AD_KEY_INTERVAL))
  85   2              if (ad_key_last > (ad_key - AD_KEY_INTERVAL) &&
  86   2                  ad_key_last < (ad_key + AD_KEY_INTERVAL))
  87   2              {
  88   3                  // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ç›¸ç­‰ï¼Œè¯´æ˜æŒ‰é”®è¿˜æœªæ¾å¼€
  89   3                  touch_time_cnt += (1 + ONE_CYCLE_TIME_MS);
  90   3      
  91   3                  if (touch_time_cnt >= LONG_PRESS_TIME_THRESHOLD_MS)
  92   3                  {
  93   4                      // å¦‚æœé•¿æŒ‰è¶…è¿‡äº†è®¾ç½®çš„é•¿æŒ‰æ—¶é—´
  94   4                      // è·³è½¬åˆ°é•¿æŒ‰å¤„ç†
  95   4                      touch_time_cnt = 0;     // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°
  96   4                      printf("long press\n"); // æµ‹è¯•ç”¨
  97   4                      ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS;
  98   4                  }
  99   3              }
 100   2              else
 101   2              {
 102   3                  // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ä¸ç›¸ç­‰ï¼Œå¹¶ä¸”ä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä
             -¸ç­‰äº0
 103   3                  // touch_time_cnt = 0; // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°ï¼ˆå¯ä»¥ç•™åˆ°æ”¶å°¾å¤„ç†ï¼‰
 104   3      
 105   3                  // è·³è½¬åˆ°çŸ­æŒ‰å¤„ç†
 106   3                  ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS;
 107   3                  printf("short press\n"); // æµ‹è¯•ç”¨
 108   3              }
 109   2      
 110   2              delay_ms(1); //
 111   2          }
 112   1      
 113   1          if (AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS == ad_key_scan_status)
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/21/2024 16:13:17 PAGE 3   

 114   1          {
 115   2              // å¦‚æœæ˜¯æ­£åœ¨å¤„ç†çŸ­æŒ‰
 116   2              // flag_get_touch_key_status = 1; // é»˜è®¤è·å–åˆ°äº†æŒ‰é”®çŠ¶æ€
 117   2      
 118   2              if (ad_key_last > (AD_KEY_ONE_LEFT_VAL - AD_KEY_INTERVAL) &&
 119   2                  ad_key_last < (AD_KEY_ONE_LEFT_VAL + AD_KEY_INTERVAL))
 120   2              {
 121   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 122   3      
 123   3                  // å¦‚æœæ²¡æœ‰æŒ‰é”®åŒå‡»ï¼Œè¯´æ˜æ˜¯çŸ­æŒ‰
 124   3      #if USE_MY_DEBUG
 125   3                  printf("one left press\n");
 126   3      #endif
 127   3                  // fun_info.touch_key_val = TOUCH_KEY_VAL_VOL_INC;
 128   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_INC);
 129   3              }
 130   2              else if (ad_key_last > (AD_KEY_TWO_LEFT_VAL - AD_KEY_INTERVAL) &&
 131   2                       ad_key_last < (AD_KEY_TWO_LEFT_VAL + AD_KEY_INTERVAL))
 132   2              {
 133   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 134   3      
 135   3                  // å¦‚æœæ²¡æœ‰æŒ‰é”®åŒå‡»ï¼Œè¯´æ˜æ˜¯çŸ­æŒ‰
 136   3      #if USE_MY_DEBUG
 137   3                  printf("two left press\n");
 138   3      #endif
 139   3                  // fun_info.touch_key_val = TOUCH_KEY_VAL_MUTE;
 140   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MUTE);
 141   3              }
 142   2              else if (ad_key_last > (AD_KEY_THREE_LEFT_VAL - AD_KEY_INTERVAL) &&
 143   2                       ad_key_last < (AD_KEY_THREE_LEFT_VAL + AD_KEY_INTERVAL))
 144   2              {
 145   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 146   3      
 147   3      #if USE_MY_DEBUG
 148   3                  printf("three left press\n");
 149   3      #endif
 150   3                  // fun_info.touch_key_val = TOUCH_KEY_VAL_VOL_DEC;
 151   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_DEC);
 152   3              }
 153   2              else if (ad_key_last > (AD_KEY_ONE_RIGHT_VAL - AD_KEY_INTERVAL) &&
 154   2                       ad_key_last < (AD_KEY_ONE_RIGHT_VAL + AD_KEY_INTERVAL))
 155   2              {
 156   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 157   3      
 158   3      #if USE_MY_DEBUG
 159   3                  printf("one right press\n");
 160   3      #endif
 161   3                  // fun_info.touch_key_val = TOUCH_KEY_VAL_NEXT;
 162   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_NEXT);
 163   3              }
 164   2              else if (ad_key_last > (AD_KEY_TWO_RIGHT_VAL - AD_KEY_INTERVAL) &&
 165   2                       ad_key_last < (AD_KEY_TWO_RIGHT_VAL + AD_KEY_INTERVAL))
 166   2              {
 167   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 168   3      
 169   3      #if USE_MY_DEBUG
 170   3                  printf("two right press\n");
 171   3      #endif
 172   3                  // fun_info.touch_key_val = TOUCH_KEY_VAL_MODE;
 173   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MODE);
 174   3              }
 175   2              else if (ad_key_last > (AD_KEY_THREE_RIGHT_VAL - AD_KEY_INTERVAL) &&
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/21/2024 16:13:17 PAGE 4   

 176   2                       ad_key_last < (AD_KEY_THREE_RIGHT_VAL + AD_KEY_INTERVAL))
 177   2              {
 178   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 179   3      
 180   3      #if USE_MY_DEBUG
 181   3                  printf("three right press\n");
 182   3      #endif
 183   3                  // fun_info.touch_key_val = TOUCH_KEY_VAL_PRE;
 184   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_PRE);
 185   3              }
 186   2              else
 187   2              {
 188   3                  // å¦‚æœæ²¡æœ‰æŒ‰é”®è¢«è§¦æ‘¸
 189   3                  // flag_get_touch_key_status = 0; // æ¸…ç©ºè¯¥æ ‡å¿—ä½ï¼Œä¸å‘é€æŒ‰é”®çŠ¶æ€
 190   3              }
 191   2      
 192   2              ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE;
 193   2          }
 194   1      
 195   1          if (AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS == ad_key_scan_status)
 196   1          {
 197   2              // flag_get_touch_key_status = 1; // é»˜è®¤è·å–åˆ°äº†æŒ‰é”®çŠ¶æ€
 198   2              // å¤„ç†é•¿æŒ‰
 199   2              if (ad_key_last > (AD_KEY_ONE_LEFT_VAL - AD_KEY_INTERVAL) &&
 200   2                  ad_key_last < (AD_KEY_ONE_LEFT_VAL + AD_KEY_INTERVAL))
 201   2              {
 202   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 203   3      
 204   3      #if USE_MY_DEBUG
 205   3                  // printf("one left long press\n");
 206   3      #endif
 207   3                  // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
 208   3              }
 209   2              else if (ad_key_last > (AD_KEY_TWO_LEFT_VAL - AD_KEY_INTERVAL) &&
 210   2                       ad_key_last < (AD_KEY_TWO_LEFT_VAL + AD_KEY_INTERVAL))
 211   2              {
 212   3                  // å¦‚æœKEY2è¢«è§¦æ‘¸
 213   3      
 214   3      #if USE_MY_DEBUG
 215   3                  printf("two left long press\n");
 216   3      #endif
 217   3                  // fun_info.touch_key_val = TOUCH_KEY_VAL_POWER;
 218   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_POWER);
 219   3              }
 220   2              else if (ad_key_last > (AD_KEY_THREE_LEFT_VAL - AD_KEY_INTERVAL) &&
 221   2                       ad_key_last < (AD_KEY_THREE_LEFT_VAL + AD_KEY_INTERVAL))
 222   2              {
 223   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 224   3      
 225   3      #if USE_MY_DEBUG
 226   3                  // printf("three left long press\n");
 227   3      #endif
 228   3                  // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
 229   3              }
 230   2              else if (ad_key_last > (AD_KEY_ONE_RIGHT_VAL - AD_KEY_INTERVAL) &&
 231   2                       ad_key_last < (AD_KEY_ONE_RIGHT_VAL + AD_KEY_INTERVAL))
 232   2              {
 233   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 234   3      
 235   3      #if USE_MY_DEBUG
 236   3                  // printf("one right long press\n");
 237   3      #endif
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/21/2024 16:13:17 PAGE 5   

 238   3                  // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
 239   3              }
 240   2              else if (ad_key_last > (AD_KEY_TWO_RIGHT_VAL - AD_KEY_INTERVAL) &&
 241   2                       ad_key_last < (AD_KEY_TWO_RIGHT_VAL + AD_KEY_INTERVAL))
 242   2              {
 243   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 244   3      
 245   3      #if USE_MY_DEBUG
 246   3                  printf("two right long press\n");
 247   3      #endif
 248   3                  // fun_info.touch_key_val = TOUCH_KEY_VAL_MAIN;
 249   3                  send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MAIN);
 250   3              }
 251   2              else if (ad_key_last > (AD_KEY_THREE_RIGHT_VAL - AD_KEY_INTERVAL) &&
 252   2                       ad_key_last < (AD_KEY_THREE_RIGHT_VAL + AD_KEY_INTERVAL))
 253   2              {
 254   3                  // å¦‚æœ  è¢«è§¦æ‘¸
 255   3      
 256   3      #if USE_MY_DEBUG
 257   3                  // printf("three right long press\n");
 258   3      #endif
 259   3                  // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
 260   3              }
 261   2      
 262   2              ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS; // è·³è½¬åˆ°é•¿æŒ‰æŒç»­
 263   2          }
 264   1      
 265   1          if (AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS == ad_key_scan_status)
 266   1          {
 267   2              // å¤„ç†é•¿æŒ‰æŒç»­
 268   2              // flag_get_touch_key_status = 1; // é»˜è®¤è·å–åˆ°äº†æŒ‰é”®çŠ¶æ€
 269   2      
 270   2              if (ad_key_last > (ad_key - AD_KEY_INTERVAL) &&
 271   2                  ad_key_last < (ad_key + AD_KEY_INTERVAL))
 272   2              {
 273   3                  touch_time_cnt++;
 274   3                  if (ad_key_last > (AD_KEY_ONE_LEFT_VAL - AD_KEY_INTERVAL) &&
 275   3                      ad_key_last < (AD_KEY_ONE_LEFT_VAL + AD_KEY_INTERVAL))
 276   3                  {
 277   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 278   4                      {
 279   5                          touch_time_cnt = 0;
 280   5      #if USE_MY_DEBUG
 281   5                          printf("one left continue press\n");
 282   5      #endif
 283   5                          // fun_info.touch_key_val = TOUCH_KEY_VAL_VOL_INC;
 284   5                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_INC);
 285   5                      }
 286   4                  }
 287   3                  else if (ad_key_last > (AD_KEY_TWO_LEFT_VAL - AD_KEY_INTERVAL) &&
 288   3                           ad_key_last < (AD_KEY_TWO_LEFT_VAL + AD_KEY_INTERVAL))
 289   3                  {
 290   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 291   4                      {
 292   5                          touch_time_cnt = 0;
 293   5      #if USE_MY_DEBUG
 294   5                          // printf("two left continue press\n");
 295   5      #endif
 296   5                          // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
 297   5                      }
 298   4                  }
 299   3                  else if (ad_key_last > (AD_KEY_THREE_LEFT_VAL - AD_KEY_INTERVAL) &&
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/21/2024 16:13:17 PAGE 6   

 300   3                           ad_key_last < (AD_KEY_THREE_LEFT_VAL + AD_KEY_INTERVAL))
 301   3                  {
 302   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 303   4                      {
 304   5                          touch_time_cnt = 0;
 305   5      #if USE_MY_DEBUG
 306   5                          // printf("three left continue press\n");
 307   5      #endif
 308   5                          // fun_info.touch_key_val = TOUCH_KEY_VAL_VOL_DEC;
 309   5                          send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_DEC);
 310   5                      }
 311   4                  }
 312   3                  else if (ad_key_last > (AD_KEY_ONE_RIGHT_VAL - AD_KEY_INTERVAL) &&
 313   3                           ad_key_last < (AD_KEY_ONE_RIGHT_VAL + AD_KEY_INTERVAL))
 314   3                  {
 315   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 316   4                      {
 317   5                          touch_time_cnt = 0;
 318   5      #if USE_MY_DEBUG
 319   5                          // printf("one right continue press\n");
 320   5      #endif
 321   5                          // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
 322   5                      }
 323   4                  }
 324   3                  else if (ad_key_last > (AD_KEY_TWO_RIGHT_VAL - AD_KEY_INTERVAL) &&
 325   3                           ad_key_last < (AD_KEY_TWO_RIGHT_VAL + AD_KEY_INTERVAL))
 326   3                  {
 327   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 328   4                      {
 329   5                          touch_time_cnt = 0;
 330   5      #if USE_MY_DEBUG
 331   5                          // printf("two right continue press\n");
 332   5      #endif
 333   5                          // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
 334   5                      }
 335   4                  }
 336   3                  else if (ad_key_last > (AD_KEY_THREE_RIGHT_VAL - AD_KEY_INTERVAL) &&
 337   3                           ad_key_last < (AD_KEY_THREE_RIGHT_VAL + AD_KEY_INTERVAL))
 338   3                  {
 339   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 340   4                      {
 341   5                          touch_time_cnt = 0;
 342   5      #if USE_MY_DEBUG
 343   5                          // printf("three right continue press\n");
 344   5      #endif
 345   5                          // flag_get_touch_key_status = 0; // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
 346   5                      }
 347   4                  }
 348   3      
 349   3                  delay_ms(1);
 350   3              }
 351   2              else
 352   2              {
 353   3                  // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸å½“å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸ä¸€è‡´ï¼Œ
 354   3                  // è¯´æ˜ å¯èƒ½æ¾å¼€äº†æ‰‹ æˆ–æ˜¯ ä¸€åªæ‰‹æŒ‰ä½äº†åŸæ¥çš„æŒ‰é”®å¦ä¸€åªæ‰‹æŒ‰äº†å…¶ä»–æ
             -Œ‰é”®
 355   3      
 356   3                  // è·³è½¬åˆ°ç­‰å¾…é•¿æŒ‰æ¾å¼€
 357   3                  ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE;
 358   3                  // flag_get_touch_key_status = 0; // æ¸…ç©ºè¯­å¥å—åˆšå¼€å§‹é»˜è®¤ç½®ä½çš„æ ‡å¿—ä½
 359   3              }
 360   2          }
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/21/2024 16:13:17 PAGE 7   

 361   1      
 362   1          if ((AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == ad_key_scan_status) ||
 363   1              (AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE == ad_key_scan_status))
 364   1          {
 365   2              // å¦‚æœæ˜¯ç­‰å¾…æŒ‰é”®æ¾å¼€
 366   2              static volatile u16 loose_cnt = 0; // å­˜æ”¾æ¾æ‰‹è®¡æ•°å€¼
 367   2      
 368   2              flag_is_detect_ad_key_press = __detect_press(ad_key);
 369   2      
 370   2              if (0 == flag_is_detect_ad_key_press)
 371   2              {
 372   3                  loose_cnt++;
 373   3                  delay_ms(1);
 374   3              }
 375   2              else
 376   2              {
 377   3                  // åªè¦æœ‰ä¸€æ¬¡æ£€æµ‹åˆ°æŒ‰é”®ï¼Œè¯´æ˜æ²¡æœ‰æ¾å¼€æ‰‹
 378   3                  loose_cnt = 0;
 379   3              }
 380   2      
 381   2              if (loose_cnt >= LOOSE_PRESS_CNT_MS) // è¿™é‡Œçš„æ¯”è¾ƒå€¼éœ€è¦æ³¨æ„ï¼Œä¸èƒ½å¤§äºå˜é‡ç±»å‹å
             -¯¹åº”çš„æœ€å¤§å€¼
 382   2              {
 383   3                  loose_cnt = 0; // æ¸…ç©ºæ¾æ‰‹è®¡æ•°
 384   3                  // å¦‚æœ xx mså†…æ²¡æœ‰æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹ï¼Œè¯´æ˜å·²ç»æ¾å¼€æ‰‹
 385   3      
 386   3                  if (AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == ad_key_scan_status)
 387   3                  {
 388   4                      if (ad_key_last > (AD_KEY_ONE_LEFT_VAL - AD_KEY_INTERVAL) &&
 389   4                          ad_key_last < (AD_KEY_ONE_LEFT_VAL + AD_KEY_INTERVAL))
 390   4                      {
 391   5      #if USE_MY_DEBUG
 392   5                          // printf("one left long press loose\n");
 393   5      #endif
 394   5                          // send_status_keyval(KEY_PRESS_LOOSE, ad_key1);
 395   5                      }
 396   4                      else if (ad_key_last > (AD_KEY_TWO_LEFT_VAL - AD_KEY_INTERVAL) &&
 397   4                               ad_key_last < (AD_KEY_TWO_LEFT_VAL + AD_KEY_INTERVAL))
 398   4                      {
 399   5      #if USE_MY_DEBUG
 400   5                          // printf("two left long press loose\n");
 401   5      #endif
 402   5                          // send_status_keyval(KEY_PRESS_LOOSE, ad_key2);
 403   5                      }
 404   4                      else if (ad_key_last > (AD_KEY_THREE_LEFT_VAL - AD_KEY_INTERVAL) &&
 405   4                               ad_key_last < (AD_KEY_THREE_LEFT_VAL + AD_KEY_INTERVAL))
 406   4                      {
 407   5      #if USE_MY_DEBUG
 408   5                          // printf("three left long press loose\n");
 409   5      #endif
 410   5                          // send_status_keyval(KEY_PRESS_LOOSE, ad_key3);
 411   5                      }
 412   4                      else if (ad_key_last > (AD_KEY_ONE_RIGHT_VAL - AD_KEY_INTERVAL) &&
 413   4                               ad_key_last < (AD_KEY_ONE_RIGHT_VAL + AD_KEY_INTERVAL))
 414   4                      {
 415   5      #if USE_MY_DEBUG
 416   5                          // printf("one right long press loose\n");
 417   5      #endif
 418   5                          // send_status_keyval(KEY_PRESS_LOOSE, ad_key4);
 419   5                      }
 420   4                      else if (ad_key_last > (AD_KEY_TWO_RIGHT_VAL - AD_KEY_INTERVAL) &&
 421   4                               ad_key_last < (AD_KEY_TWO_RIGHT_VAL + AD_KEY_INTERVAL))
C51 COMPILER V9.60.7.0   AD_KEY                                                            11/21/2024 16:13:17 PAGE 8   

 422   4                      {
 423   5      #if USE_MY_DEBUG
 424   5                          // printf("two right long press loose\n");
 425   5      #endif
 426   5                          // send_status_keyval(KEY_PRESS_LOOSE, ad_key5);
 427   5                      }
 428   4                      else if (ad_key_last > (AD_KEY_THREE_RIGHT_VAL - AD_KEY_INTERVAL) &&
 429   4                               ad_key_last < (AD_KEY_THREE_RIGHT_VAL + AD_KEY_INTERVAL))
 430   4                      {
 431   5      #if USE_MY_DEBUG
 432   5                          // printf("three right long press loose\n");
 433   5      #endif
 434   5                          // send_status_keyval(KEY_PRESS_LOOSE, ad_key5);
 435   5                      }
 436   4                  }
 437   3      
 438   3                  ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_END; // è·³è½¬åˆ°æ”¶å°¾å¤„ç†
 439   3              }
 440   2          }
 441   1      
 442   1          if (AD_KEY_SCAN_STATUS_IS_END == ad_key_scan_status)
 443   1          {
 444   2              // æ”¶å°¾å¤„ç†
 445   2              ad_key = 0;
 446   2              ad_key_last = 0;
 447   2              touch_time_cnt = 0;
 448   2              flag_is_detect_ad_key_press = 0;
 449   2      
 450   2              // fun_info.touch_key_val = 0;
 451   2      
 452   2              ad_key_scan_status = AD_KEY_SCAN_STATUS_NONE;
 453   2          }
 454   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1312    ----
   CONSTANT SIZE    =    196    ----
   XDATA SIZE       =     22       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
